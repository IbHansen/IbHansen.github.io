
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8. Create a small model from scratch and save it &#8212; ModelFlow</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="9. Experiment: Export up" href="modelstart%20export%20up.html" />
    <link rel="prev" title="7. Extend Pandas dataframes with ModelFLow capabilities." href="../update/extending_dataframes.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ModelFlow</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../introduction.html">
   Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Model, solutions and Modelflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/model%20and%20solution.html">
   1. What is a Model in ModelFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/Example%20Solow.html">
   3. Example Solow model
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python and pandas stuff
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/Intro_Jupyter_notebook.html">
   4. Introduction to the Jupyter Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/pandas/dataframes.html">
   5. Introduction to Pandas dataframes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Updating variables
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../update/model%20update.html">
   6. Update, modifying series in a dataframe using modelflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../update/extending_dataframes.html">
   7. Extend Pandas dataframes with ModelFLow capabilities.
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  A small demo model
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Create a small model from scratch and save it
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="modelstart%20export%20up.html">
   9. Experiment: Export up
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Make experiments
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/create_experiment.html">
   10. Create an experiment, simulate it and access results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/create_save_scenarios.html">
   11. Create many scenarios, simulate them  and access results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../experiments/Standard%20experiment%20simple.html">
   12. A experiment using Taxes on Goods and Services
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Onboarding MFMod models from .wf1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/onboard%20one%20model%20from%20%20wf1.html">
   13. Onboard a model defined in a .wf1 file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/onboard%20many%20models%20from%20wf1.html">
   14. Onboard all models  defined in .wf1 files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onboard/eviews/Normalizing%20when%20onboarding%20eviews.html">
   15. Normalizing when onboarding  eviews models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Fixing the value of designated variables.
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../fixing/Fixing%20variables.html">
   16. Fixing the value of variables
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Features
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Python/modelflow_features.html">
   17. Useful model instance properties and methods
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Structure
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../structure/Logical_structure.html">
   18. Logical structure and dependencies.
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Attribution
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution/Attribution%20background.html">
   19. Attribution
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Specification
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../notebooks/intro/model%20specification.html">
   20. Specification of models (introduction)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../optimization/Optimize_simpel.html">
   21. Mean variance optimization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  More
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../litterature.html">
   23. Litterature
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Jupyter book test
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../booktest.html">
   24. Test of Jupyter book features.
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/howto/smallmodel/modelstart.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fcontent/howto/smallmodel/modelstart.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/content/howto/smallmodel/modelstart.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-the-national-account-data">
   8.1. Load the  national account data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-we-got-a-pandas-dataframe-with-the-values">
     8.1.1. Now we got a pandas dataframe with the values
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specify-a-small-demo-model">
   8.2. Specify  a (small demo) model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-the-specification-to-modelflow">
   8.3. Convert the specification to modelflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-the-model">
   8.4. Get the model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-some-variable-descriptions">
     8.4.1. Inject some variable descriptions.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-model-equations">
     8.4.2. The model equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-model-structure-can-be-drawn">
     8.4.3. The model structure can be drawn
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#only-the-endogenous-variables">
     8.4.4. Only the endogenous variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-adjacendy-matrix-for-the-endogenous-variables">
     8.4.5. The adjacendy matrix for the endogenous variables.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-dataframe-has-to-be-enriched">
   8.5. The Dataframe has to be enriched:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-parameter-values">
     8.5.1. The parameter values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-the-variables-defined-by-identities-in-the-specification">
     8.5.2. Generate the variables defined by identities in the specification.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-the-add-factors-which-will-ensure-that-the-model-result-match-the-data">
     8.5.3. Generate the add factors which will ensure that the model result match the data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dump-the-model-and-the-data-in-a-file-to-be-used-in-the-next-episode">
   8.6. Dump the model and the data in a file to be used in the next episode
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Create a small model from scratch and save it</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-the-national-account-data">
   8.1. Load the  national account data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-we-got-a-pandas-dataframe-with-the-values">
     8.1.1. Now we got a pandas dataframe with the values
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specify-a-small-demo-model">
   8.2. Specify  a (small demo) model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-the-specification-to-modelflow">
   8.3. Convert the specification to modelflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-the-model">
   8.4. Get the model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inject-some-variable-descriptions">
     8.4.1. Inject some variable descriptions.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-model-equations">
     8.4.2. The model equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-model-structure-can-be-drawn">
     8.4.3. The model structure can be drawn
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#only-the-endogenous-variables">
     8.4.4. Only the endogenous variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-adjacendy-matrix-for-the-endogenous-variables">
     8.4.5. The adjacendy matrix for the endogenous variables.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-dataframe-has-to-be-enriched">
   8.5. The Dataframe has to be enriched:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-parameter-values">
     8.5.1. The parameter values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-the-variables-defined-by-identities-in-the-specification">
     8.5.2. Generate the variables defined by identities in the specification.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-the-add-factors-which-will-ensure-that-the-model-result-match-the-data">
     8.5.3. Generate the add factors which will ensure that the model result match the data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dump-the-model-and-the-data-in-a-file-to-be-used-in-the-next-episode">
   8.6. Dump the model and the data in a file to be used in the next episode
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="create-a-small-model-from-scratch-and-save-it">
<h1><span class="section-number">8. </span>Create a small model from scratch and save it<a class="headerlink" href="#create-a-small-model-from-scratch-and-save-it" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span>  <span class="nn">modelmacrograb</span> <span class="kn">import</span> <span class="n">GrabMacroModel</span>
<span class="kn">from</span> <span class="nn">modelclass</span> <span class="kn">import</span> <span class="n">model</span>
<span class="n">model</span><span class="o">.</span><span class="n">widescreen</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
    div#notebook-container    { width: 95%; }
    div#menubar-container     { width: 65%; }
    div#maintoolbar-container { width: 99%; }
</style>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">modeljupytermagic</span>  <span class="c1"># to activate %%dataframe</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-the-national-account-data">
<h2><span class="section-number">8.1. </span>Load the  national account data<a class="headerlink" href="#load-the-national-account-data" title="Permalink to this headline">¶</a></h2>
<p>Using a jupyter magic command (something starting with %%) defined in modeljupytermagic</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">dataframe</span> smalldata start=2011
Y CPV I G X M YDISC
2011 1562682. 1320302. 373938.8 131272.0 121715.0 444232.2 59686.22
2012 1632040. 1360376. 381170.2 128860.1 146292.9 457745.7 73087.14
2013 1689572. 1396402. 414556.8 124254.9 165234.6 522447.7 111572.0
2014 1791141. 1438904. 466473.0 138532.7 194705.5 632207.9 184733.1
2015 1862357. 1476067. 536416.7 154466.9 199214.9 692794.8 188986.9
2016 1870424. 1537410. 570679.5 135990.5 164738.9 714625.6 176230.0
2017 2038337. 1549515. 702407.5 165119.3 179327.0 916469.9 358437.5
2018 2193706. 1645118. 785371.4 168506.8 193124.7 1090956. 492542.0
2019 2339741. 1737872. 874480.5 180872.4 203830.6 1154398. 497084.1
2020 2295808. 1802824. 843961.1 192010.8 171282.5 978064.9 263794.1
2021 2327410. 1846635. 866899.3 211728.7 140302.8 1009072. 270916.5
2022 2402827. 1914157. 941428.0 240255.2 152623.9 1127119. 281482.2
2023 2536741. 2007600. 1060909. 252761.7 179968.7 1260336. 295838.0
2024 2715810. 2151422. 1205927. 278364.4 199108.6 1414850. 295837.8
2025 2924763. 2300322. 1359892. 307746.9 220190.6 1559226. 295837.8
2026 3140827. 2444181. 1512696. 337450.3 242638.9 1691977. 295837.8
2027 3335992. 2552411. 1652032. 363373.5 266225.5 1793888. 295837.8
2028 3528125. 2635657. 1787782. 388431.1 290729.5 1870312. 295837.8
2029 3729062. 2714120. 1927845. 414569.4 316021.6 1939332. 295837.8
2030 3945452. 2802550. 2076752. 441658.4 342117.3 2013464. 295837.8
</pre></div>
</div>
</div>
</div>
<div class="section" id="now-we-got-a-pandas-dataframe-with-the-values">
<h3><span class="section-number">8.1.1. </span>Now we got a pandas dataframe with the values<a class="headerlink" href="#now-we-got-a-pandas-dataframe-with-the-values" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smalldata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Y</th>
      <th>CPV</th>
      <th>I</th>
      <th>G</th>
      <th>X</th>
      <th>M</th>
      <th>YDISC</th>
    </tr>
    <tr>
      <th>index</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011</th>
      <td>1562682.0</td>
      <td>1320302.0</td>
      <td>373938.8</td>
      <td>131272.0</td>
      <td>121715.0</td>
      <td>444232.2</td>
      <td>59686.22</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>1632040.0</td>
      <td>1360376.0</td>
      <td>381170.2</td>
      <td>128860.1</td>
      <td>146292.9</td>
      <td>457745.7</td>
      <td>73087.14</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>1689572.0</td>
      <td>1396402.0</td>
      <td>414556.8</td>
      <td>124254.9</td>
      <td>165234.6</td>
      <td>522447.7</td>
      <td>111572.00</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>1791141.0</td>
      <td>1438904.0</td>
      <td>466473.0</td>
      <td>138532.7</td>
      <td>194705.5</td>
      <td>632207.9</td>
      <td>184733.10</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>1862357.0</td>
      <td>1476067.0</td>
      <td>536416.7</td>
      <td>154466.9</td>
      <td>199214.9</td>
      <td>692794.8</td>
      <td>188986.90</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>1870424.0</td>
      <td>1537410.0</td>
      <td>570679.5</td>
      <td>135990.5</td>
      <td>164738.9</td>
      <td>714625.6</td>
      <td>176230.00</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>2038337.0</td>
      <td>1549515.0</td>
      <td>702407.5</td>
      <td>165119.3</td>
      <td>179327.0</td>
      <td>916469.9</td>
      <td>358437.50</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>2193706.0</td>
      <td>1645118.0</td>
      <td>785371.4</td>
      <td>168506.8</td>
      <td>193124.7</td>
      <td>1090956.0</td>
      <td>492542.00</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>2339741.0</td>
      <td>1737872.0</td>
      <td>874480.5</td>
      <td>180872.4</td>
      <td>203830.6</td>
      <td>1154398.0</td>
      <td>497084.10</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>2295808.0</td>
      <td>1802824.0</td>
      <td>843961.1</td>
      <td>192010.8</td>
      <td>171282.5</td>
      <td>978064.9</td>
      <td>263794.10</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>2327410.0</td>
      <td>1846635.0</td>
      <td>866899.3</td>
      <td>211728.7</td>
      <td>140302.8</td>
      <td>1009072.0</td>
      <td>270916.50</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>2402827.0</td>
      <td>1914157.0</td>
      <td>941428.0</td>
      <td>240255.2</td>
      <td>152623.9</td>
      <td>1127119.0</td>
      <td>281482.20</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>2536741.0</td>
      <td>2007600.0</td>
      <td>1060909.0</td>
      <td>252761.7</td>
      <td>179968.7</td>
      <td>1260336.0</td>
      <td>295838.00</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>2715810.0</td>
      <td>2151422.0</td>
      <td>1205927.0</td>
      <td>278364.4</td>
      <td>199108.6</td>
      <td>1414850.0</td>
      <td>295837.80</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>2924763.0</td>
      <td>2300322.0</td>
      <td>1359892.0</td>
      <td>307746.9</td>
      <td>220190.6</td>
      <td>1559226.0</td>
      <td>295837.80</td>
    </tr>
    <tr>
      <th>2026</th>
      <td>3140827.0</td>
      <td>2444181.0</td>
      <td>1512696.0</td>
      <td>337450.3</td>
      <td>242638.9</td>
      <td>1691977.0</td>
      <td>295837.80</td>
    </tr>
    <tr>
      <th>2027</th>
      <td>3335992.0</td>
      <td>2552411.0</td>
      <td>1652032.0</td>
      <td>363373.5</td>
      <td>266225.5</td>
      <td>1793888.0</td>
      <td>295837.80</td>
    </tr>
    <tr>
      <th>2028</th>
      <td>3528125.0</td>
      <td>2635657.0</td>
      <td>1787782.0</td>
      <td>388431.1</td>
      <td>290729.5</td>
      <td>1870312.0</td>
      <td>295837.80</td>
    </tr>
    <tr>
      <th>2029</th>
      <td>3729062.0</td>
      <td>2714120.0</td>
      <td>1927845.0</td>
      <td>414569.4</td>
      <td>316021.6</td>
      <td>1939332.0</td>
      <td>295837.80</td>
    </tr>
    <tr>
      <th>2030</th>
      <td>3945452.0</td>
      <td>2802550.0</td>
      <td>2076752.0</td>
      <td>441658.4</td>
      <td>342117.3</td>
      <td>2013464.0</td>
      <td>295837.80</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="specify-a-small-demo-model">
<h2><span class="section-number">8.2. </span>Specify  a (small demo) model<a class="headerlink" href="#specify-a-small-demo-model" title="Permalink to this headline">¶</a></h2>
<p>Consumption
Lets make consumption a function of GDP (a proxy for incomes) and just to be fancy we will do it an error correction format.</p>
<p><strong>Long run equation</strong></p>
<p><span class="math notranslate nohighlight">\( CPV_t= \alpha + \beta * Y_t +\eta_t \)</span></p>
<p>ECM</p>
<p><span class="math notranslate nohighlight">\( \Delta cpv_t = - \gamma *(cpv_{t-1}- y_{t-1} - \beta_2 ) + \Delta y_t \)</span> where lowercase variables preprsent the logarithm of the original variable</p>
<p>dlog(cpv)= -gamma_cpv*(log(cpv(-1))-log(y(-1)) - beta_cpv)+beta2_cpv*dlog(y)</p>
<p>dlog(g)=-gamma_g*(log(g(-1))-log(y(-1)) - beta_g)+beta2_g*dlog(y)</p>
<p>dlog(i)=-gamma_i*(log(i(-1))-log(y(-1)-g(-1)) - beta_i)+beta2_i*dlog(y)</p>
<p>dlog(m)=-gamma_m*(log(m(-1))-log(gde(-1)) - beta_m)+beta2_m*dlog(gde)</p>
<p>y=cpv+i+g+x-m+ydisc</p>
<p>gde=cpv+i+g</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smallmodel</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;exo z&gt; dlog(cpv)= -c2_cpv*(log(cpv(-1))-log(y(-1)) -        c1_cpv)+c3_cpv*dlog(y)</span>

<span class="s1">&lt;exo z&gt; dlog(g)  = -c2_g*  (log(g(-1))-  log(y(-1)) -        c1_g)  +c3_g*dlog(y)</span>

<span class="s1">&lt;exo z&gt; dlog(i)  = -c2_i*  (log(i(-1))-  log(y(-1)-g(-1)) - c1_i)   +c3_i*dlog(y) </span>
<span class="s1"> </span>
<span class="s1">&lt;exo z&gt; dlog(m) =  -c2_m*  (log(m(-1))-   log(gde(-1))    - c1_m)   +c3_m*dlog(gde)</span>
<span class="s1"> </span>
<span class="s1">&lt;ident&gt; y=cpv+i+g+x-m+ydisc</span>
<span class="s1"> </span>
<span class="s1">&lt;ident&gt; gde=cpv+i+g</span>

<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="convert-the-specification-to-modelflow">
<h2><span class="section-number">8.3. </span>Convert the specification to modelflow<a class="headerlink" href="#convert-the-specification-to-modelflow" title="Permalink to this headline">¶</a></h2>
<p>Here <code class="docutils literal notranslate"><span class="pre">GrabMacroModel</span></code> is used to process the model specification. It has been designed to process this type of models and can handle:</p>
<ul class="simple">
<li><p>Introducing add_factors</p></li>
<li><p>Normalize equations</p></li>
<li><p>Make equations fixable</p></li>
<li><p>Generate equations for fitted values</p></li>
<li><p>Create model to calculate add factors</p></li>
<li><p>Create model to calculate fitted values</p></li>
<li><p>Create model to calculate identities</p></li>
</ul>
<p>In the next cell it is shown how each equation flows trough several phases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thismodel</span> <span class="o">=</span> <span class="n">GrabMacroModel</span><span class="p">(</span><span class="n">smallmodel</span><span class="p">,</span><span class="n">modelname</span> <span class="o">=</span> <span class="s1">&#39;Small demo model&#39;</span><span class="p">,</span><span class="n">make_fitted</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Frml name:&lt;EXO Z&gt;
Endo_var        : CPV
Original        :  DLOG(CPV)= -C2_CPV*(LOG(CPV(-1))-LOG(Y(-1)) -        C1_CPV)+C3_CPV*DLOG(Y)
Preprocessed    : ((LOG(CPV))-(LOG(CPV(-1))))=-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1))))
Normalized      : CPV = (CPV(-1)*EXP(CPV_A+ (-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1))))) )) * (1-CPV_D)+ CPV_X*CPV_D 
Calc_add_factor : CPV_A = - ((-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1)))))) +LOG(CPV)-LOG(CPV(-1))
Fitted          : CPV_FITTED = CPV(-1)*EXP( (-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1))))) )

Frml name:&lt;EXO Z&gt;
Endo_var        : G
Original        :  DLOG(G)  = -C2_G*  (LOG(G(-1))-  LOG(Y(-1)) -        C1_G)  +C3_G*DLOG(Y)
Preprocessed    : ((LOG(G))-(LOG(G(-1))))=-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1))))
Normalized      : G = (G(-1)*EXP(G_A+ (-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1))))) )) * (1-G_D)+ G_X*G_D 
Calc_add_factor : G_A = - ((-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1)))))) +LOG(G)-LOG(G(-1))
Fitted          : G_FITTED = G(-1)*EXP( (-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1))))) )

Frml name:&lt;EXO Z&gt;
Endo_var        : I
Original        :  DLOG(I)  = -C2_I*  (LOG(I(-1))-  LOG(Y(-1)-G(-1)) - C1_I)   +C3_I*DLOG(Y) 
Preprocessed    : ((LOG(I))-(LOG(I(-1))))=-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1))))
Normalized      : I = (I(-1)*EXP(I_A+ (-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1))))) )) * (1-I_D)+ I_X*I_D 
Calc_add_factor : I_A = - ((-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1)))))) +LOG(I)-LOG(I(-1))
Fitted          : I_FITTED = I(-1)*EXP( (-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1))))) )

Frml name:&lt;EXO Z&gt;
Endo_var        : M
Original        :  DLOG(M) =  -C2_M*  (LOG(M(-1))-   LOG(GDE(-1))    - C1_M)   +C3_M*DLOG(GDE)
Preprocessed    : ((LOG(M))-(LOG(M(-1))))=-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1))))
Normalized      : M = (M(-1)*EXP(M_A+ (-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1))))) )) * (1-M_D)+ M_X*M_D 
Calc_add_factor : M_A = - ((-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1)))))) +LOG(M)-LOG(M(-1))
Fitted          : M_FITTED = M(-1)*EXP( (-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1))))) )

Frml name:&lt;IDENT&gt;
Endo_var        : Y
Original        :  Y=CPV+I+G+X-M+YDISC
Preprocessed    : Y=CPV+I+G+X-M+YDISC
Normalized      : Y = CPV+I+G+X-M+YDISC

Frml name:&lt;IDENT&gt;
Endo_var        : GDE
Original        :  GDE=CPV+I+G
Preprocessed    : GDE=CPV+I+G
Normalized      : GDE = CPV+I+G
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-the-model">
<h2><span class="section-number">8.4. </span>Get the model<a class="headerlink" href="#get-the-model" title="Permalink to this headline">¶</a></h2>
<p>As a convention <strong>m</strong> is used as prefix for model objects.</p>
<p>So the model is called <code class="docutils literal notranslate"><span class="pre">msmallmodel</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span> <span class="o">=</span> <span class="n">thismodel</span><span class="o">.</span><span class="n">mmodel</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inject-some-variable-descriptions">
<h3><span class="section-number">8.4.1. </span>Inject some variable descriptions.<a class="headerlink" href="#inject-some-variable-descriptions" title="Permalink to this headline">¶</a></h3>
<p>A Python dictionary is used for storing variable descriptions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">descriptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;CPV&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Private Consumption&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Y&#39;</span>     <span class="p">:</span> <span class="s1">&#39;GDP&#39;</span> <span class="p">,</span>
    <span class="s1">&#39;G&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Government&#39;</span> <span class="p">,</span>
    <span class="s1">&#39;I&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Investment&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GDE&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Gross Domestic Expenditure&#39;</span><span class="p">,</span>
    <span class="s1">&#39;X&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Export&#39;</span><span class="p">,</span>
    <span class="s1">&#39;M&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Import&#39;</span><span class="p">,</span>
    <span class="s1">&#39;YDISC&#39;</span> <span class="p">:</span>  <span class="s1">&#39;Discrepance&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">msmallmodel</span><span class="o">.</span><span class="n">set_var_description</span><span class="p">(</span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">enrich_var_description</span><span class="p">(</span><span class="n">descriptions</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-model-equations">
<h3><span class="section-number">8.4.2. </span>The model equations<a class="headerlink" href="#the-model-equations" title="Permalink to this headline">¶</a></h3>
<p>Each equation has the form:</p>
<blockquote>
<div><p>FRML &lt;[options]…&gt; &lt;left hand variable&gt; = &lt;right hand side expression&gt;$</p>
</div></blockquote>
<p>Equations with the option <code class="docutils literal notranslate"><span class="pre">CALC_ADD_FACTOR</span></code> specifies a separate model which can be used to calculate the add factors
which makes left hand side equals to the right hand side (without any fixing)</p>
<p>So there are actually specified two models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">equations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FRML &lt;EXO Z&gt; CPV = (CPV(-1)*EXP(CPV_A+ (-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1))))) )) * (1-CPV_D)+ CPV_X*CPV_D $
FRML &lt;EXO Z&gt; G = (G(-1)*EXP(G_A+ (-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1))))) )) * (1-G_D)+ G_X*G_D $
FRML &lt;EXO Z&gt; I = (I(-1)*EXP(I_A+ (-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1))))) )) * (1-I_D)+ I_X*I_D $
FRML &lt;EXO Z&gt; M = (M(-1)*EXP(M_A+ (-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1))))) )) * (1-M_D)+ M_X*M_D $
FRML &lt;IDENT&gt; Y = CPV+I+G+X-M+YDISC$
FRML &lt;IDENT&gt; GDE = CPV+I+G$
FRML &lt;FIT&gt; CPV_FITTED = CPV(-1)*EXP( (-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1))))) )$
FRML &lt;FIT&gt; G_FITTED = G(-1)*EXP( (-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1))))) )$
FRML &lt;FIT&gt; I_FITTED = I(-1)*EXP( (-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1))))) )$
FRML &lt;FIT&gt; M_FITTED = M(-1)*EXP( (-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1))))) )$
FRML &lt;CALC_ADD_FACTOR&gt; CPV_A = - ((-C2_CPV*(LOG(CPV(-1))-LOG(Y(-1))-C1_CPV)+C3_CPV*((LOG(Y))-(LOG(Y(-1)))))) +LOG(CPV)-LOG(CPV(-1))$
FRML &lt;CALC_ADD_FACTOR&gt; G_A = - ((-C2_G*(LOG(G(-1))-LOG(Y(-1))-C1_G)+C3_G*((LOG(Y))-(LOG(Y(-1)))))) +LOG(G)-LOG(G(-1))$
FRML &lt;CALC_ADD_FACTOR&gt; I_A = - ((-C2_I*(LOG(I(-1))-LOG(Y(-1)-G(-1))-C1_I)+C3_I*((LOG(Y))-(LOG(Y(-1)))))) +LOG(I)-LOG(I(-1))$
FRML &lt;CALC_ADD_FACTOR&gt; M_A = - ((-C2_M*(LOG(M(-1))-LOG(GDE(-1))-C1_M)+C3_M*((LOG(GDE))-(LOG(GDE(-1)))))) +LOG(M)-LOG(M(-1))$
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-model-structure-can-be-drawn">
<h3><span class="section-number">8.4.3. </span>The model structure can be drawn<a class="headerlink" href="#the-model-structure-can-be-drawn" title="Permalink to this headline">¶</a></h3>
<p>Notice that mouseover shows additional information</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">drawmodel</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/modelstart_21_0.svg" src="../../../_images/modelstart_21_0.svg" /></div>
</div>
</div>
<div class="section" id="only-the-endogenous-variables">
<h3><span class="section-number">8.4.4. </span>Only the endogenous variables<a class="headerlink" href="#only-the-endogenous-variables" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">drawendo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/modelstart_23_0.svg" src="../../../_images/modelstart_23_0.svg" /></div>
</div>
</div>
<div class="section" id="the-adjacendy-matrix-for-the-endogenous-variables">
<h3><span class="section-number">8.4.5. </span>The adjacendy matrix for the endogenous variables.<a class="headerlink" href="#the-adjacendy-matrix-for-the-endogenous-variables" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">plotadjacency</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/modelstart_25_0.png" src="../../../_images/modelstart_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">endogene</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;CPV&#39;,
 &#39;CPV_FITTED&#39;,
 &#39;G&#39;,
 &#39;GDE&#39;,
 &#39;G_FITTED&#39;,
 &#39;I&#39;,
 &#39;I_FITTED&#39;,
 &#39;M&#39;,
 &#39;M_FITTED&#39;,
 &#39;Y&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">exogene</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;C1_CPV&#39;,
 &#39;C1_G&#39;,
 &#39;C1_I&#39;,
 &#39;C1_M&#39;,
 &#39;C2_CPV&#39;,
 &#39;C2_G&#39;,
 &#39;C2_I&#39;,
 &#39;C2_M&#39;,
 &#39;C3_CPV&#39;,
 &#39;C3_G&#39;,
 &#39;C3_I&#39;,
 &#39;C3_M&#39;,
 &#39;CPV_A&#39;,
 &#39;CPV_D&#39;,
 &#39;CPV_X&#39;,
 &#39;G_A&#39;,
 &#39;G_D&#39;,
 &#39;G_X&#39;,
 &#39;I_A&#39;,
 &#39;I_D&#39;,
 &#39;I_X&#39;,
 &#39;M_A&#39;,
 &#39;M_D&#39;,
 &#39;M_X&#39;,
 &#39;X&#39;,
 &#39;YDISC&#39;}
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="the-dataframe-has-to-be-enriched">
<h2><span class="section-number">8.5. </span>The Dataframe has to be enriched:<a class="headerlink" href="#the-dataframe-has-to-be-enriched" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The the parameter values</p></li>
<li><p>Variables mentioned in the model, but not present in the dataframe</p></li>
<li><p>Calculated variables from the model has to be calculated</p></li>
<li><p>Add factors ensuring that the solution match the data has to be calculated.</p></li>
</ul>
<div class="section" id="the-parameter-values">
<h3><span class="section-number">8.5.1. </span>The parameter values<a class="headerlink" href="#the-parameter-values" title="Permalink to this headline">¶</a></h3>
<p>Modelflow is <strong>not an estimation tool</strong>. So we have to provide the estimated parameters. <br>
This can be done in several way:</p>
<ul class="simple">
<li><p>The parameters can be input into the equations. This can be automated.</p></li>
<li><p>The parameters can be broadcast into a dataframe. Which is what we will do here.</p></li>
</ul>
<p>For this purpose a “magic” jupyter command will be used. It will create a dataframe with the right values:</p>
<p><strong>Modelflow don’t have a special datatype for parameters</strong> so we just repeat the same value for all years</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">dataframe</span> parameters   periods=20 start=2011 melt t 

      c2      c1      c3 
cpv   0.38 -0.11 0.02946
g     0.3 -2.5974  1.332   
i     0.3  -2.59 1.332
m     0.37  -1.57 5.0929 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline_first</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">smalldata</span><span class="p">,</span><span class="n">parameters_melted</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">baseline_first</span>  <span class="o">=</span> <span class="n">msmallmodel</span><span class="o">.</span><span class="n">insertModelVar</span><span class="p">(</span><span class="n">baseline_first</span><span class="p">)</span>
<span class="n">baseline_first</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>index</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Y</th>
      <td>1.562682e+06</td>
      <td>1.632040e+06</td>
      <td>1.689572e+06</td>
      <td>1.791141e+06</td>
      <td>1.862357e+06</td>
    </tr>
    <tr>
      <th>CPV</th>
      <td>1.320302e+06</td>
      <td>1.360376e+06</td>
      <td>1.396402e+06</td>
      <td>1.438904e+06</td>
      <td>1.476067e+06</td>
    </tr>
    <tr>
      <th>I</th>
      <td>3.739388e+05</td>
      <td>3.811702e+05</td>
      <td>4.145568e+05</td>
      <td>4.664730e+05</td>
      <td>5.364167e+05</td>
    </tr>
    <tr>
      <th>G</th>
      <td>1.312720e+05</td>
      <td>1.288601e+05</td>
      <td>1.242549e+05</td>
      <td>1.385327e+05</td>
      <td>1.544669e+05</td>
    </tr>
    <tr>
      <th>X</th>
      <td>1.217150e+05</td>
      <td>1.462929e+05</td>
      <td>1.652346e+05</td>
      <td>1.947055e+05</td>
      <td>1.992149e+05</td>
    </tr>
    <tr>
      <th>M</th>
      <td>4.442322e+05</td>
      <td>4.577457e+05</td>
      <td>5.224477e+05</td>
      <td>6.322079e+05</td>
      <td>6.927948e+05</td>
    </tr>
    <tr>
      <th>YDISC</th>
      <td>5.968622e+04</td>
      <td>7.308714e+04</td>
      <td>1.115720e+05</td>
      <td>1.847331e+05</td>
      <td>1.889869e+05</td>
    </tr>
    <tr>
      <th>C2_CPV</th>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
    </tr>
    <tr>
      <th>C1_CPV</th>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
    </tr>
    <tr>
      <th>C3_CPV</th>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
    </tr>
    <tr>
      <th>C2_G</th>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
    </tr>
    <tr>
      <th>C1_G</th>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
    </tr>
    <tr>
      <th>C3_G</th>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
    </tr>
    <tr>
      <th>C2_I</th>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
    </tr>
    <tr>
      <th>C1_I</th>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
    </tr>
    <tr>
      <th>C3_I</th>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
    </tr>
    <tr>
      <th>C2_M</th>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
    </tr>
    <tr>
      <th>C1_M</th>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
    </tr>
    <tr>
      <th>C3_M</th>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
    </tr>
    <tr>
      <th>M_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>GDE</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>M_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>M_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>M_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="generate-the-variables-defined-by-identities-in-the-specification">
<h3><span class="section-number">8.5.2. </span>Generate the variables defined by identities in the specification.<a class="headerlink" href="#generate-the-variables-defined-by-identities-in-the-specification" title="Permalink to this headline">¶</a></h3>
<p>A model which can calculate the identities can be extracted from the model instance by <code class="docutils literal notranslate"><span class="pre">.get_histmodel()</span></code>.</p>
<p>This small model is run for all years.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist_smallmodel</span> <span class="o">=</span> <span class="n">msmallmodel</span><span class="o">.</span><span class="n">get_histmodel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">hist_smallmodel</span><span class="o">.</span><span class="n">equations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FRML &lt;IDENT&gt; Y = CPV+I+G+X-M+YDISC$
FRML &lt;IDENT&gt; GDE = CPV+I+G$
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline</span> <span class="o">=</span> <span class="n">hist_smallmodel</span><span class="p">(</span><span class="n">baseline_first</span><span class="p">,</span><span class="n">silent</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>index</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Y</th>
      <td>1.562682e+06</td>
      <td>1.632041e+06</td>
      <td>1.689573e+06</td>
      <td>1.791140e+06</td>
      <td>1.862358e+06</td>
    </tr>
    <tr>
      <th>CPV</th>
      <td>1.320302e+06</td>
      <td>1.360376e+06</td>
      <td>1.396402e+06</td>
      <td>1.438904e+06</td>
      <td>1.476067e+06</td>
    </tr>
    <tr>
      <th>I</th>
      <td>3.739388e+05</td>
      <td>3.811702e+05</td>
      <td>4.145568e+05</td>
      <td>4.664730e+05</td>
      <td>5.364167e+05</td>
    </tr>
    <tr>
      <th>G</th>
      <td>1.312720e+05</td>
      <td>1.288601e+05</td>
      <td>1.242549e+05</td>
      <td>1.385327e+05</td>
      <td>1.544669e+05</td>
    </tr>
    <tr>
      <th>X</th>
      <td>1.217150e+05</td>
      <td>1.462929e+05</td>
      <td>1.652346e+05</td>
      <td>1.947055e+05</td>
      <td>1.992149e+05</td>
    </tr>
    <tr>
      <th>M</th>
      <td>4.442322e+05</td>
      <td>4.577457e+05</td>
      <td>5.224477e+05</td>
      <td>6.322079e+05</td>
      <td>6.927948e+05</td>
    </tr>
    <tr>
      <th>YDISC</th>
      <td>5.968622e+04</td>
      <td>7.308714e+04</td>
      <td>1.115720e+05</td>
      <td>1.847331e+05</td>
      <td>1.889869e+05</td>
    </tr>
    <tr>
      <th>C2_CPV</th>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
    </tr>
    <tr>
      <th>C1_CPV</th>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
    </tr>
    <tr>
      <th>C3_CPV</th>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
    </tr>
    <tr>
      <th>C2_G</th>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
    </tr>
    <tr>
      <th>C1_G</th>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
    </tr>
    <tr>
      <th>C3_G</th>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
    </tr>
    <tr>
      <th>C2_I</th>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
    </tr>
    <tr>
      <th>C1_I</th>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
    </tr>
    <tr>
      <th>C3_I</th>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
    </tr>
    <tr>
      <th>C2_M</th>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
    </tr>
    <tr>
      <th>C1_M</th>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
    </tr>
    <tr>
      <th>C3_M</th>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
    </tr>
    <tr>
      <th>M_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>GDE</th>
      <td>1.825513e+06</td>
      <td>1.870406e+06</td>
      <td>1.935214e+06</td>
      <td>2.043910e+06</td>
      <td>2.166951e+06</td>
    </tr>
    <tr>
      <th>CPV_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>M_FITTED</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>M_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>M_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="generate-the-add-factors-which-will-ensure-that-the-model-result-match-the-data">
<h3><span class="section-number">8.5.3. </span>Generate the add factors which will ensure that the model result match the data<a class="headerlink" href="#generate-the-add-factors-which-will-ensure-that-the-model-result-match-the-data" title="Permalink to this headline">¶</a></h3>
<p>The model is named <code class="docutils literal notranslate"><span class="pre">.calc_add_factor_model()</span></code> and run for the relevant years:</p>
<p>In addition if a model to create fitted values is present it will also be run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fitbaseline</span> <span class="o">=</span> <span class="n">msmallmodel</span><span class="o">.</span><span class="n">calc_add_factor_model</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span><span class="s1">&#39;2016&#39;</span><span class="p">,</span><span class="s1">&#39;2030&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">thismodel</span><span class="o">.</span><span class="n">mfitmodel</span> <span class="p">:</span> <span class="n">fitbaseline</span> <span class="o">=</span> <span class="n">thismodel</span><span class="o">.</span><span class="n">mfitmodel</span><span class="p">(</span><span class="n">fitbaseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Will start calculating: Calculate add factors
2016  solved
2017  solved
2018  solved
2019  solved
2020  solved
2021  solved
2022  solved
2023  solved
2024  solved
2025  solved
2026  solved
2027  solved
2028  solved
2029  solved
2030  solved
Calculate add factors calculated 
Will start calculating: Small demo model calc fittet values
2012  solved
2013  solved
2014  solved
2015  solved
2016  solved
2017  solved
2018  solved
2019  solved
2020  solved
2021  solved
2022  solved
2023  solved
2024  solved
2025  solved
2026  solved
2027  solved
2028  solved
2029  solved
2030  solved
Small demo model calc fittet values calculated 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fitbaseline</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2014&#39;</span><span class="p">:</span><span class="s1">&#39;2020&#39;</span><span class="p">,]</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>index</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Y</th>
      <td>1.791140e+06</td>
      <td>1.862358e+06</td>
      <td>1.870423e+06</td>
      <td>2.038336e+06</td>
      <td>2.193707e+06</td>
      <td>2.339742e+06</td>
      <td>2.295808e+06</td>
    </tr>
    <tr>
      <th>CPV</th>
      <td>1.438904e+06</td>
      <td>1.476067e+06</td>
      <td>1.537410e+06</td>
      <td>1.549515e+06</td>
      <td>1.645118e+06</td>
      <td>1.737872e+06</td>
      <td>1.802824e+06</td>
    </tr>
    <tr>
      <th>I</th>
      <td>4.664730e+05</td>
      <td>5.364167e+05</td>
      <td>5.706795e+05</td>
      <td>7.024075e+05</td>
      <td>7.853714e+05</td>
      <td>8.744805e+05</td>
      <td>8.439611e+05</td>
    </tr>
    <tr>
      <th>G</th>
      <td>1.385327e+05</td>
      <td>1.544669e+05</td>
      <td>1.359905e+05</td>
      <td>1.651193e+05</td>
      <td>1.685068e+05</td>
      <td>1.808724e+05</td>
      <td>1.920108e+05</td>
    </tr>
    <tr>
      <th>X</th>
      <td>1.947055e+05</td>
      <td>1.992149e+05</td>
      <td>1.647389e+05</td>
      <td>1.793270e+05</td>
      <td>1.931247e+05</td>
      <td>2.038306e+05</td>
      <td>1.712825e+05</td>
    </tr>
    <tr>
      <th>M</th>
      <td>6.322079e+05</td>
      <td>6.927948e+05</td>
      <td>7.146256e+05</td>
      <td>9.164699e+05</td>
      <td>1.090956e+06</td>
      <td>1.154398e+06</td>
      <td>9.780649e+05</td>
    </tr>
    <tr>
      <th>YDISC</th>
      <td>1.847331e+05</td>
      <td>1.889869e+05</td>
      <td>1.762300e+05</td>
      <td>3.584375e+05</td>
      <td>4.925420e+05</td>
      <td>4.970841e+05</td>
      <td>2.637941e+05</td>
    </tr>
    <tr>
      <th>C2_CPV</th>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
      <td>3.800000e-01</td>
    </tr>
    <tr>
      <th>C1_CPV</th>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
      <td>-1.100000e-01</td>
    </tr>
    <tr>
      <th>C3_CPV</th>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
      <td>2.946000e-02</td>
    </tr>
    <tr>
      <th>C2_G</th>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
    </tr>
    <tr>
      <th>C1_G</th>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
      <td>-2.597400e+00</td>
    </tr>
    <tr>
      <th>C3_G</th>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
    </tr>
    <tr>
      <th>C2_I</th>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
      <td>3.000000e-01</td>
    </tr>
    <tr>
      <th>C1_I</th>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
      <td>-2.590000e+00</td>
    </tr>
    <tr>
      <th>C3_I</th>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
      <td>1.332000e+00</td>
    </tr>
    <tr>
      <th>C2_M</th>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
      <td>3.700000e-01</td>
    </tr>
    <tr>
      <th>C1_M</th>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
      <td>-1.570000e+00</td>
    </tr>
    <tr>
      <th>C3_M</th>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
      <td>5.092900e+00</td>
    </tr>
    <tr>
      <th>M_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>G_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_FITTED</th>
      <td>3.069111e+05</td>
      <td>3.301703e+05</td>
      <td>3.511096e+05</td>
      <td>4.106828e+05</td>
      <td>4.780094e+05</td>
      <td>5.227907e+05</td>
      <td>5.141391e+05</td>
    </tr>
    <tr>
      <th>GDE</th>
      <td>2.043910e+06</td>
      <td>2.166951e+06</td>
      <td>2.244080e+06</td>
      <td>2.417042e+06</td>
      <td>2.598996e+06</td>
      <td>2.793225e+06</td>
      <td>2.838796e+06</td>
    </tr>
    <tr>
      <th>CPV_FITTED</th>
      <td>1.442298e+06</td>
      <td>1.501462e+06</td>
      <td>1.546577e+06</td>
      <td>1.592550e+06</td>
      <td>1.652847e+06</td>
      <td>1.763442e+06</td>
      <td>1.865086e+06</td>
    </tr>
    <tr>
      <th>G_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>-1.008167e-01</td>
      <td>7.239171e-02</td>
      <td>-5.228553e-02</td>
      <td>-5.720258e-03</td>
      <td>9.622777e-02</td>
    </tr>
    <tr>
      <th>G_FITTED</th>
      <td>1.348067e+05</td>
      <td>1.442680e+05</td>
      <td>1.504155e+05</td>
      <td>1.535884e+05</td>
      <td>1.775517e+05</td>
      <td>1.819100e+05</td>
      <td>1.743952e+05</td>
    </tr>
    <tr>
      <th>G_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>I_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.857292e-01</td>
      <td>5.366926e-01</td>
      <td>4.965263e-01</td>
      <td>5.144488e-01</td>
      <td>4.956126e-01</td>
    </tr>
    <tr>
      <th>CPV_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_X</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>CPV_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>-5.944844e-03</td>
      <td>-2.739478e-02</td>
      <td>-4.686922e-03</td>
      <td>-1.460601e-02</td>
      <td>-3.395268e-02</td>
    </tr>
    <tr>
      <th>M_FITTED</th>
      <td>6.266769e+05</td>
      <td>7.352346e+05</td>
      <td>7.061892e+05</td>
      <td>8.910391e+05</td>
      <td>1.062194e+06</td>
      <td>1.214574e+06</td>
      <td>9.724242e+05</td>
    </tr>
    <tr>
      <th>M_A</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.187554e-02</td>
      <td>2.814086e-02</td>
      <td>2.671811e-02</td>
      <td>-5.081463e-02</td>
      <td>5.783861e-03</td>
    </tr>
    <tr>
      <th>M_D</th>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">msmallmodel</span><span class="p">(</span><span class="n">fitbaseline</span><span class="p">,</span><span class="s1">&#39;2020&#39;</span><span class="p">,</span><span class="s1">&#39;2030&#39;</span><span class="p">,</span><span class="n">silent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">)</span>
<span class="n">msmallmodel</span><span class="o">.</span><span class="n">basedf</span> <span class="o">=</span> <span class="n">fitbaseline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="p">[</span><span class="s1">&#39;#endo&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ab84e64e32fd4d37ae4edd957347d122", "version_major": 2, "version_minor": 0}
</script><div class="output text_html"></div></div>
</div>
</div>
</div>
<div class="section" id="dump-the-model-and-the-data-in-a-file-to-be-used-in-the-next-episode">
<h2><span class="section-number">8.6. </span>Dump the model and the data in a file to be used in the next episode<a class="headerlink" href="#dump-the-model-and-the-data-in-a-file-to-be-used-in-the-next-episode" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msmallmodel</span><span class="o">.</span><span class="n">modeldump</span><span class="p">(</span><span class="s1">&#39;models/smallmodel.pcim&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content\howto\smallmodel"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../update/extending_dataframes.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Extend Pandas dataframes with ModelFLow capabilities.</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="modelstart%20export%20up.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Experiment: Export up</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Ib Hansen<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>