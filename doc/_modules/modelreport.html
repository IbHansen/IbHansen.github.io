

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modelreport &mdash; ModelFlow  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/Core.html">Core Modules, creates and solves model instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onboard/onboard.html">Processing model specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../attribution/Attribution.html">Attribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vis/modelvis.html">Quick result visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/modelreport.html">Report writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotly/modeldashsidebar.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/jupyter.html">Jupyter Stuff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/modelinvert.html">Targets and instruments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/modelmf.html">Enrich dataframes with modelflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/model_cvx.html">Convex optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/modelsandbox.html">Template for a user defined  model class based on the model class</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ModelFlow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">modelreport</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for modelreport</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Apr  8 14:58:26 2024</span>

<span class="sd">@author: ibhan</span>

<span class="sd">The `modelreport` module facilitates the generation, management, and display of data visualizations and tables </span>
<span class="sd">derived from ModelFlow models. It is designed to support a wide range of output formats including LaTeX documents, </span>
<span class="sd">HTML, and interactive IPyWidgets, making it highly versatile for different reporting and analysis needs in Jupyter </span>
<span class="sd">notebook environments.</span>

<span class="sd">This module provides a structured and extendible  approach to organizing and rendering data analysis results, enabling users to </span>
<span class="sd">easily convert complex model outputs into digestible visual representations and tables. It is especially useful </span>
<span class="sd">for automating the reporting process in data analysis, financial modeling, and research projects, leveraging Python&#39;s </span>
<span class="sd">capabilities for data processing and visualization along with advanced document presentation features.</span>

<span class="sd">Key Features:</span>
<span class="sd">    </span>
<span class="sd">- Dynamic generation of LaTeX and HTML content for integrating data visualizations and tables into reports and </span>
<span class="sd">  presentations.</span>
<span class="sd">- Compatibility with IPyWidgets for creating interactive, widget-based displays that enhance the interactivity of </span>
<span class="sd">  Jupyter notebooks.</span>
<span class="sd">- Seamless integration with matplotlib for figure generation and pandas for table formatting, providing a comprehensive </span>
<span class="sd">  toolkit for data display.</span>
<span class="sd">- Customizable display options and specifications through dataclasses, allowing for tailored presentation styles </span>
<span class="sd">  and formats.</span>

<span class="sd">Classes:</span>
<span class="sd">    </span>
<span class="sd">- :class:`Options`: Configures display options for managing how data and figures are presented, including naming conventions, </span>
<span class="sd">  formatting preferences, and title settings.</span>
<span class="sd">- :class:`Line`: Defines line configurations for table displays, supporting various data representation and difference </span>
<span class="sd">  calculations to suit different analysis needs.</span>
<span class="sd">- :class:`DisplaySpec`: Groups display options and line configurations, facilitating the management of complex display setups </span>
<span class="sd">  in a structured manner.</span>
<span class="sd">- :class:`DisplayDef`: Base class for display definitions, capable of compiling various display components into cohesive </span>
<span class="sd">  specifications for rendering.</span>
<span class="sd">- :class:`LatexRepo`: Handles the generation of LaTeX content, compilation into PDFs, and embedding within Jupyter notebooks, </span>
<span class="sd">  supporting both static and dynamic content creation.</span>
<span class="sd">- :class:`DisplayVarTableDef`: Specializes in displaying variable tables, automating the creation and formatting of tables </span>
<span class="sd">  from ModelFlow model outputs.</span>
<span class="sd">- :class:`DisplayFigWrapDef`: Focuses on wrapping and adjusting matplotlib figures for inclusion in various display formats, </span>
<span class="sd">  ensuring figures are presentation-ready.</span>
<span class="sd">- :class:`SplitTextResult`: Parses a string containing text with embedded &lt;html&gt;, &lt;latex&gt;, and &lt;markdown&gt; tags and separates </span>
<span class="sd">  the content accordingly.</span>
<span class="sd">- :class:`DatatypeAccessor`: Manages configurations for different datatypes, allowing for easy access and parsing of </span>
<span class="sd">  configuration tables provided in Markdown format.</span>
<span class="sd"> </span>

<span class="sd">The `modeldisplay` module bridges the gap between analytical modeling and result presentation, offering a streamlined </span>
<span class="sd">workflow for transforming ModelFlow model outputs into high-quality visual and tabular displays suitable for a wide </span>
<span class="sd">range of purposes.</span>
<span class="sd">&quot;&quot;&quot;</span>





<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="kn">import</span> <span class="nn">fnmatch</span> 
<span class="kn">import</span> <span class="nn">re</span> 
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">dates</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">asdict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span>  <span class="n">Optional</span> <span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span>  <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>  
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span><span class="p">,</span><span class="n">Latex</span><span class="p">,</span> <span class="n">Markdown</span><span class="p">,</span><span class="n">HTML</span> <span class="p">,</span> <span class="n">IFrame</span>





<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">run</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">webbrowser</span> <span class="k">as</span> <span class="nn">wb</span>

<span class="n">WIDTH</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="s1">&#39;400px&#39;</span>


<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">MISSING</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>


<span class="kn">from</span> <span class="nn">modelwidget</span> <span class="kn">import</span> <span class="n">fig_to_image</span><span class="p">,</span><span class="n">tabwidget</span><span class="p">,</span><span class="n">htmlwidget_fig</span><span class="p">,</span> <span class="n">htmlwidget_df</span><span class="p">,</span><span class="n">htmlwidget_text</span><span class="p">,</span><span class="n">htmlwidget_style</span>

<div class="viewcode-block" id="track_fields">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.track_fields">[docs]</a>
<span class="k">def</span> <span class="nf">track_fields</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A decorator to track which fields in a dataclass have been explicitly set during initialization.</span>

<span class="sd">    This decorator modifies the `__init__` method of a dataclass to keep track of which fields</span>
<span class="sd">    have been explicitly set by the user when an instance is created. The explicitly set fields</span>
<span class="sd">    are stored in a set called `__explicitly_set__`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        wrap (function): A decorator function that modifies the dataclass to track explicitly set fields.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">__original_init</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">args</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__explicitly_set__</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__original_init</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span> <span class="o">=</span> <span class="fm">__init__</span>
        <span class="k">return</span> <span class="bp">cls</span>
    <span class="k">return</span> <span class="n">wrap</span></div>


<div class="viewcode-block" id="DatatypeAccessor">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DatatypeAccessor">[docs]</a>
<span class="k">class</span> <span class="nc">DatatypeAccessor</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the ConfigAccessor with a datatype and a configuration table in Markdown format.</span>

<span class="sd">        :param datatype: A string keyword to fetch configuration for.</span>
<span class="sd">        :param config_table: A string representing the configuration in Markdown table format.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">datatype</span>
        
        <span class="c1"># {var_name}</span>
        <span class="c1"># {var_description}</span>
        <span class="c1"># {compare}     Keep name used for comparison</span>
        
        <span class="k">if</span> <span class="s1">&#39;config_table&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">config_table</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config_table&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>     
        
            <span class="n">config_table</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">| datatype  | showtype   | diftype | col_desc | ax_title_template|</span>
<span class="s2">|-----------|----------|---------|------------------|------------|</span>
<span class="s2">| growth     | growth    | nodif   | Percent growth    | </span><span class="si">{var_description}</span><span class="s2"> \n</span><span class="si">% g</span><span class="s2">rowth                      |</span>
<span class="s2">| difgrowth  | growth    | dif      | Impact, Percent growth | </span><span class="si">{var_description}</span><span class="s2"> \nImpact, </span><span class="si">% g</span><span class="s2">rowth v|</span>
<span class="s2">| gdppct     | gdppct    | nodif   | Percent of GDP | </span><span class="si">{var_description}</span><span class="s2"> \n(</span><span class="si">% G</span><span class="s2">DP)                       |</span>
<span class="s2">| difgdppct  | gdppct    | dif     |  Impact, Percent of GDP  | </span><span class="si">{var_description}</span><span class="s2"> \nImpact (</span><span class="si">% G</span><span class="s2">DP) vs </span><span class="si">{compare}</span><span class="s2">   |</span>
<span class="s2">| level      | level     | nodif   | Level | </span><span class="si">{var_description}</span><span class="s2">                                 |</span>
<span class="s2">| diflevel   | level     | dif      | Impact, Level    | </span><span class="si">{var_description}</span><span class="s2"> \nChange vs </span><span class="si">{compare}</span><span class="s2">           |</span>
<span class="s2">| difpctlevel| level     | difpct   | Impact in percent | </span><span class="si">{var_description}</span><span class="s2"> \n% Change vs </span><span class="si">{compare}</span><span class="s2">          |</span>
<span class="s2">| qoq_ar     | qoq_ar    | nodif    | Q-Q anuallized   | </span><span class="si">{var_description}</span><span class="s2"> \nQ-Q annualized                |</span>
<span class="s2">| difqoq_ar  | qoq_ar    | dif     | Impact Q-Q anuallized  | </span><span class="si">{var_description}</span><span class="s2"> \nImpact Q-Q annualized vs </span><span class="si">{compare}</span><span class="s2">  |</span>
<span class="s2">| baselevel  | level     | basedf  | Base Level    | </span><span class="si">{var_description}</span><span class="s2"> \nBase Level                    |</span>
<span class="s2">| basegrowth | growth    | basedf    | Base Percent growth  | </span><span class="si">{var_description}</span><span class="s2"> \nBase </span><span class="si">% g</span><span class="s2">rowth                 |</span>
<span class="s2">| basegdppct | gdppct    | basedf |  Base Percent of GDP    | </span><span class="si">{var_description}</span><span class="s2"> \nBase </span><span class="si">% o</span><span class="s2">f GDP                 |</span>
<span class="s2">| baseqoq_ar | qoq_ar    | basedf  | Base Q-Q anuallized  | </span><span class="si">{var_description}</span><span class="s2"> \nBase Q-Q annualized           |</span>

<span class="s2">&quot;&quot;&quot;</span>


            <span class="n">config_table</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">| datatype     | showtype  | diftype | col_desc                  | ax_title_template                                | ax_title_template_df                           |</span>
<span class="s2">|--------------|-----------|---------|---------------------------|-------------------------------------------------|------------------------------------------------|</span>
<span class="s2">| growth       | growth    | nodif   | Percent growth             | </span><span class="si">{var_description}</span><span class="s2"> \n</span><span class="si">% g</span><span class="s2">rowth                    | </span><span class="si">{var_description}</span><span class="s2"> \n</span><span class="si">% g</span><span class="s2">rowth                   |</span>
<span class="s2">| difgrowth    | growth    | dif     | Impact, Percent growth     | </span><span class="si">{var_description}</span><span class="s2"> \nImpact, </span><span class="si">% g</span><span class="s2">rowth vs </span><span class="si">{compare}</span><span class="s2"> | </span><span class="si">{var_description}</span><span class="s2"> \nImpact, % |</span>
<span class="s2">| gdppct       | gdppct    | nodif   | Percent of GDP             | </span><span class="si">{var_description}</span><span class="s2"> \n(</span><span class="si">% G</span><span class="s2">DP)                     | </span><span class="si">{var_description}</span><span class="s2"> \n(</span><span class="si">% G</span><span class="s2">DP)                    |</span>
<span class="s2">| difgdppct    | gdppct    | dif     | Impact, Percent of GDP     | </span><span class="si">{var_description}</span><span class="s2"> \nImpact (</span><span class="si">% G</span><span class="s2">DP) vs </span><span class="si">{compare}</span><span class="s2"> | </span><span class="si">{var_description}</span><span class="s2"> \nImpact (</span><span class="si">% G</span><span class="s2">DP) |</span>
<span class="s2">| level        | level     | nodif   | Level                     | </span><span class="si">{var_description}</span><span class="s2">                               | </span><span class="si">{var_description}</span><span class="s2">                              |</span>
<span class="s2">| diflevel     | level     | dif     | Impact, Level              | </span><span class="si">{var_description}</span><span class="s2"> \nChange vs </span><span class="si">{compare}</span><span class="s2">         | </span><span class="si">{var_description}</span><span class="s2"> \nChange        |</span>
<span class="s2">| difpctlevel  | level     | difpct  | Impact in percent          | </span><span class="si">{var_description}</span><span class="s2"> \n% Change vs </span><span class="si">{compare}</span><span class="s2">       | </span><span class="si">{var_description}</span><span class="s2"> \n% Change      |</span>
<span class="s2">| qoq_ar       | qoq_ar    | nodif   | Q-Q annualized             | </span><span class="si">{var_description}</span><span class="s2"> \nQ-Q annualized              | </span><span class="si">{var_description}</span><span class="s2"> \nQ-Q annualized             |</span>
<span class="s2">| difqoq_ar    | qoq_ar    | dif     | Impact Q-Q annualized      | </span><span class="si">{var_description}</span><span class="s2"> \nImpact Q-Q annualized vs </span><span class="si">{compare}</span><span class="s2"> | </span><span class="si">{var_description}</span><span class="s2"> \nImpact Q-Q annualized |</span>
<span class="s2">| baselevel    | level     | basedf  | Baseline                 | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline                   | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline Level                 |</span>
<span class="s2">| basegrowth   | growth    | basedf  | Baseline Percent growth        | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline </span><span class="si">% g</span><span class="s2">rowth               | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline </span><span class="si">% g</span><span class="s2">rowth              |</span>
<span class="s2">| basegdppct   | gdppct    | basedf  | Baseline Percent of GDP        | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline </span><span class="si">% o</span><span class="s2">f GDP               | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline </span><span class="si">% o</span><span class="s2">f GDP              |</span>
<span class="s2">| baseqoq_ar   | qoq_ar    | basedf  | Baseline Q-Q annualized        | </span><span class="si">{var_description}</span><span class="s2"> \nBaseline Q-Q annualized         | </span><span class="si">{var_description}</span><span class="s2"> \\nBaseline Q-Q annualized        |</span>

<span class="s2">&quot;&quot;&quot;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">configurations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_config_table</span><span class="p">(</span><span class="n">config_table</span><span class="p">)</span>
        <span class="c1"># print(self.configurations)</span>

        <span class="c1"># Apply any overrides from kwargs</span>
        <span class="c1"># if datatype in self.configurations:</span>
        <span class="c1">#     self.configurations[datatype].update((k, v) for k, v in kwargs.items() if k in self.configurations[datatype])</span>


<div class="viewcode-block" id="DatatypeAccessor.parse_config_table">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DatatypeAccessor.parse_config_table">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_config_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config_table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses a Markdown table into a dictionary of configurations.</span>

<span class="sd">        :param config_table: Markdown table as a string.</span>
<span class="sd">        :return: Dictionary with datatype keys and property dictionaries as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">lines</span> <span class="o">=</span> <span class="n">config_table</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*\|\s*&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>  <span class="c1"># Skip the header and delimiter rows</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*\|\s*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="c1"># print(f&#39;{line=}&#39;)</span>
            <span class="c1"># print(f&#39;{values=}&#39;)</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="n">headers</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))}</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;datatype&#39;</span><span class="p">)</span>  <span class="c1"># Remove the datatype key to use as the dictionary key</span>
            <span class="n">configs</span><span class="p">[</span><span class="n">datatype</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>

        <span class="k">return</span> <span class="n">configs</span></div>


    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides dynamic access to configuration properties based on the initial datatype.</span>

<span class="sd">        :param item: The property name to fetch from the configuration for the provided datatype.</span>
<span class="sd">        :return: The value associated with &#39;item&#39; under the specified datatype&#39;s configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configurations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">config_data</span><span class="p">:</span>
            <span class="n">allowed</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Allowed datatypes:&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configurations</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration for datatype &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="o">+</span><span class="n">allowed</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

               







<div class="viewcode-block" id="Options">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.Options">[docs]</a>
<span class="nd">@track_fields</span><span class="p">()</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Options</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents configuration options for data display definitions.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Name for this display. Default is &#39;Display&#39;. </span>
<span class="sd">        foot (str): Footer if relevant. Default is an empty string.</span>
<span class="sd">        rename (bool): If True, allows renaming of data columns. Default is True.</span>
<span class="sd">        decorate (bool): If True, decorates row descriptions based on the showtype. Default is True.</span>
<span class="sd">        width (int): Specifies the width for formatting output in characters. Default is 20.</span>
<span class="sd">        custom_description (Dict[str, str]): Custom descriptions to augment or override default descriptions. Empty by default.</span>
<span class="sd">        title (str): Text for the title. Default is an empty string.</span>
<span class="sd">        chunk_size (int): Specifies the number of columns per chunk in the display output. Default is 0 (no chunking).</span>
<span class="sd">        timeslice (List): Specifies the time slice for data display. Empty by default.</span>
<span class="sd">        max_cols (int): Maximum columns when displayed as string. Default is 6.</span>
<span class="sd">        last_cols (int): In Latex, specifies the number of last columns to include in a display slice. Default is 1.</span>
<span class="sd">        ncol (int): Number of columns in figures. Default is 2.</span>
<span class="sd">        samefig (bool): If True, use the same figure for multiple plots. Default is False.</span>
<span class="sd">        size (tuple): Tuple specifying the figure size (width, height). Default is (10, 6).</span>
<span class="sd">        legend (bool): If True, display legend in plots. Default is True.</span>
<span class="sd">        transpose (bool): If True, transpose the data when displaying. Default is False.</span>
<span class="sd">        scenarios (str): Text specifying the scenarios for the display. Default is an empty string. if Empty use basedf/lastdf </span>
<span class="sd">        smpl (tuple): Tuple specifying start and end periods. Default is (&#39;&#39;, &#39;&#39;).</span>
<span class="sd">        landscape (bool): If True, the table will be displayed in landscape mode. Default is False.</span>
<span class="sd">        latex_text (str): Text for a LaTeX output. Default is an empty string.</span>
<span class="sd">        html_text (str): Text for an HTML output. Default is an empty string.</span>
<span class="sd">        text_text (str): Text for a plain text output. Default is an empty string.</span>
<span class="sd">        markdown_text (str): Text for a Markdown output. Default is an empty string.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>
<span class="sd">        __add__(other): Merges this Options instance with another &#39;Options&#39; instance or a dictionary. It returns a new Options</span>
<span class="sd">                    instance that combines settings from both, preferring non-default values from &#39;other&#39;. If &#39;other&#39; is a</span>
<span class="sd">                    dictionary, attributes not existing in this instance will raise an AttributeError. TypeErrors are raised</span>
<span class="sd">                    when &#39;other&#39; is neither a dictionary nor an Options instance.</span>

<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Display&#39;</span>
    <span class="n">foot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">rename</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">decorate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">custom_description</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  
    <span class="n">timeslice</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">max_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">last_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">ncol</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">samefig</span> <span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span> 
    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">transpose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">scenarios</span> <span class="p">:</span> <span class="nb">str</span>  <span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">smpl</span> <span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">landscape</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">latex_text</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">html_text</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">text_text</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">markdown_text</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="c1"># print(f&#39;Blank space is not allowed in name, renamed: {self.name}&#39;)</span>

    
    <span class="k">def</span> <span class="nf">was_explicitly_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># Using getattr with three arguments to avoid KeyError and return False when the attribute isn&#39;t found</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__explicitly_set__&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
    

<div class="viewcode-block" id="Options.__add__">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.Options.__add__">[docs]</a>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">Options</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Operand must be an instance of Options or dict.&quot;</span><span class="p">)</span>

        <span class="c1"># Create a new instance by deeply copying the current one</span>
        <span class="n">new_instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Get default values for comparison</span>
        <span class="n">default_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">default</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MISSING</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">default_factory</span><span class="p">()</span>
                          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)}</span>

        <span class="k">def</span> <span class="nf">is_explicitly_set</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">default</span> <span class="ow">or</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">other</span>  <span class="c1"># Check if the attribute is present in &#39;other&#39;</span>


        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Update using dictionary</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_instance</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">new_instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="o">...</span>
                    <span class="c1"># raise AttributeError(f&quot;No such attribute {key}  in Options class.&quot;)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Options</span><span class="p">):</span>
            <span class="c1"># Update using another Options instance, but only for non-default values</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">was_explicitly_set</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">new_instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_instance</span></div>
</div>





   
<div class="viewcode-block" id="Line">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.Line">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dataclass for representing and validating line configurations for data display.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        datatype  (str): Specifies the datatype as defines in DatatypeAccessor </span>
<span class="sd">        textlinetype (str): = &#39;textline&#39; if the line is a textline in a table </span>
<span class="sd">        centertext (str): Center text used when showtype is &#39;textline&#39;. Default is a space.</span>
<span class="sd">        rename (bool): If True, allows renaming of data columns. Default is True.</span>
<span class="sd">        dec (int): Specifies the number of decimal places to use for numerical output. Default is 2.</span>
<span class="sd">        pat (str): Pattern or identifier used to select data for the line. Default is &#39;#Headline&#39;.</span>
<span class="sd">        latexfont (str) : Modifier used in lates for instande r&#39;\textbf&#39; </span>
<span class="sd">        default_ax_title_template(str) Table specific template for individual chart titles</span>
<span class="sd">        ax_title_template(str) user provided Table specific template for individual chart titles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">datatype</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;level&#39;</span>
    <span class="n">scale</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="n">kind</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span>
    <span class="n">centertext</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">rename</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">dec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">pat</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;#Headline&#39;</span>
    <span class="n">latexfont</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">by_var</span> <span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span> 
    <span class="n">mul</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> 
    <span class="n">yunit</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">datatype_desc</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ax_title_template</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">textlinetype</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># default_ax_title_template :str = field(init=False) </span>
    <span class="c1"># default_ax_title_template_df :str = field(init=False)</span>
    <span class="c1"># showtype: str = field(init=False)</span>
    <span class="c1"># diftype: str = field(init=False)</span>


    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">config</span> <span class="o">=</span> <span class="n">DatatypeAccessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showtype</span>                      <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">showtype</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">diftype</span>                       <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">diftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_ax_title_template</span>     <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">ax_title_template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_ax_title_template_df</span>  <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">ax_title_template_df</span>

        <span class="n">valid_showtypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;growth&#39;</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;basedf&#39;</span><span class="p">,</span> <span class="s1">&#39;gdppct&#39;</span> <span class="p">,</span><span class="s1">&#39;textline&#39;</span><span class="p">,</span><span class="s1">&#39;qoq_ar&#39;</span><span class="p">}</span>
        <span class="n">valid_diftypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodif&#39;</span><span class="p">,</span> <span class="s1">&#39;dif&#39;</span><span class="p">,</span> <span class="s1">&#39;difpct&#39;</span><span class="p">,</span> <span class="s1">&#39;basedf&#39;</span><span class="p">,</span> <span class="s1">&#39;lastdf&#39;</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_showtypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;showtype must be one of </span><span class="si">{</span><span class="n">valid_showtypes</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">showtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diftype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_diftypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;diftype must be one of </span><span class="si">{</span><span class="n">valid_diftypes</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">diftype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="DisplaySpec">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplaySpec">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplaySpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dataclass to encapsulate display specifications including options and a list of line configurations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        options (Options): An instance of the Options dataclass specifying configuration options.</span>
<span class="sd">        lines (List[Line]): A list of Line instances specifying individual line configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">display_type</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Options</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Options</span><span class="p">)</span>
    <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Line</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DisplaySpec</span><span class="p">):</span>
            <span class="n">new_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">options</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">lines</span>  <span class="c1"># extends the list with other&#39;s lines</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Options</span><span class="p">):</span>
            <span class="n">new_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">+</span> <span class="n">other</span>  <span class="c1"># update options</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>  <span class="nb">dict</span><span class="p">):</span>
            <span class="n">new_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">+</span> <span class="n">other</span>  <span class="c1"># update options</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Line</span><span class="p">):</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">+</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>  <span class="c1"># creates a new list with the added line</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">Line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">other</span><span class="p">):</span>
            <span class="n">new_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">+</span> <span class="n">other</span>  <span class="c1"># extends the list with the new lines</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Operand must be an instance of DisplaySpec, Options, dict, Line, or list of Line instances.&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">new_options</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="n">new_lines</span><span class="p">)</span>
    
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;DisplaySpec&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a DisplaySpec instance from a JSON string using the class that called this method,</span>
<span class="sd">        which supports use by subclasses.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">        json_str (str): A JSON string representation of a DisplaySpec instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        DisplaySpec: The constructed DisplaySpec instance (or an instance of a subclass).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
        <span class="n">options_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="n">lines_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span>
    
        <span class="c1"># Create Options instance from options data</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="n">options_data</span><span class="p">)</span>
    
        <span class="c1"># Create list of Line instances from lines data</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line</span><span class="p">(</span><span class="o">**</span><span class="n">line_data</span><span class="p">)</span> <span class="k">for</span> <span class="n">line_data</span> <span class="ow">in</span> <span class="n">lines_data</span><span class="p">]</span>
    
        <span class="c1"># Return an instance of the calling class, which may be DisplaySpec or any of its subclasses</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">display_type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the DisplaySpec instance into a JSON string.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        str: A JSON string representation of the DisplaySpec instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert DisplaySpec instance to dictionary</span>
        
        <span class="n">display_spec_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_type&quot;</span><span class="p">:</span><span class="n">display_type</span><span class="p">,</span>  <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">),</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">asdict</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">]}</span>
        <span class="c1"># print(display_spec_dict)</span>
        <span class="c1"># Serialize the dictionary to a JSON string</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">display_spec_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>





<div class="viewcode-block" id="DisplayDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayDef">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplayDef</span><span class="p">:</span>
    <span class="n">mmodel</span>      <span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">spec</span> <span class="p">:</span> <span class="n">DisplaySpec</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">DisplaySpec</span><span class="p">)</span>
    <span class="n">name</span>        <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">lines</span> 
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">defsub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">var_description</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">custom_description</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">var_description</span> <span class="o">=</span> <span class="p">{}</span>
            
            
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="p">[]</span>
        
    
<div class="viewcode-block" id="DisplayDef.set_name">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayDef.set_name">[docs]</a>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> 
        <span class="k">return</span> <span class="bp">self</span></div>

    
    
    
    <span class="nd">@property</span>  
    <span class="k">def</span> <span class="nf">get_report_smpl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
            <span class="n">report_smpl</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>     
            <span class="n">report_smpl</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> 
        <span class="k">return</span> <span class="n">report_smpl</span>    


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">save_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">display_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">new_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">+</span> <span class="n">Options</span><span class="p">(</span><span class="n">smpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_smpl</span><span class="p">)</span>
        <span class="c1"># print(f&quot;\n{Options(smpl = self.report_smpl)=}&quot;)</span>
        <span class="c1"># print(f&quot;\n{new_spec=}&quot;)</span>
        <span class="c1"># print(f&quot;\n{new_spec=}&quot;)</span>
        <span class="c1"># out = self.spec.to_json(display_type) </span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">new_spec</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="DisplayDef.get_rowdes">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayDef.get_rowdes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_rowdes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">thisdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">row</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">rename</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">rename</span><span class="p">:</span>
            <span class="n">rowdes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_description</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">rowdes</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">decorate</span> <span class="p">:</span>
            <span class="k">match</span> <span class="n">line</span><span class="o">.</span><span class="n">showtype</span><span class="p">:</span>
                <span class="k">case</span> <span class="s1">&#39;growth&#39;</span><span class="p">:</span>
                    <span class="n">rowdes</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">des</span><span class="si">}</span><span class="s1">, % growth&#39;</span> <span class="k">for</span> <span class="n">des</span> <span class="ow">in</span>    <span class="n">rowdes</span><span class="p">]</span>
        
                <span class="k">case</span> <span class="s1">&#39;gdppct&#39;</span><span class="p">:</span>
                    <span class="n">rowdes</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">des</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;mill&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, % of GDP&#39;</span> <span class="k">for</span> <span class="n">des</span> <span class="ow">in</span>    <span class="n">rowdes</span><span class="p">]</span>
                    
        
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="n">rowdes</span> <span class="o">=</span> <span class="n">rowdes</span>
        <span class="c1"># print(f&#39;get_rowdes {line=}&#39;)            </span>
        <span class="n">thisdf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">rowdes</span> 
        <span class="n">dfout</span> <span class="o">=</span> <span class="n">thisdf</span> <span class="k">if</span> <span class="n">row</span> <span class="k">else</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">T</span> 
        <span class="k">return</span> <span class="n">dfout</span> </div>




    
 
   
   
<div class="viewcode-block" id="DisplayDef.pdf">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayDef.pdf">[docs]</a>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pdfopen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span><span class="n">typesetter</span><span class="o">=</span><span class="s1">&#39;xelatex  -interaction=batchmode -no-shell-escape&#39;</span><span class="p">):</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">LatexRepo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latex</span> <span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">repo</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pdfopen</span><span class="p">,</span><span class="n">show</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">typesetter</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines two DisplayDef instances into a new DisplayDef with combined specifications.</span>
<span class="sd">    </span>
<span class="sd">        :param other: Another DisplayDef instance to add.</span>
<span class="sd">        :return: A new DisplayDef instance with merged specifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span><span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>  <span class="o">+</span> <span class="p">[</span><span class="n">get_DisplayTextDef</span><span class="p">(</span><span class="n">other</span><span class="p">)])</span>

        <span class="k">else</span><span class="p">:</span>
      
            <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span><span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">])</span>
    
        <span class="c1"># Create a new DisplayDef with the combined specifications</span>
        <span class="k">return</span> <span class="n">out</span> 

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines two DisplayDef instances into a new DisplayDef with combined specifications.</span>
<span class="sd">    </span>
<span class="sd">        :param other: Another DisplayDef instance to add.</span>
<span class="sd">        :return: A new DisplayDef instance with merged specifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># If the left-hand side operand is a string, this method will be called</span>
                <span class="n">linstance</span> <span class="o">=</span>  <span class="n">get_DisplayTextDef</span><span class="p">(</span><span class="n">input_string</span> <span class="o">=</span> <span class="n">other</span><span class="p">)</span>
          
            
                <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span><span class="o">=</span> <span class="p">[</span><span class="n">linstance</span><span class="p">,</span><span class="bp">self</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>


        <span class="c1"># out = DisplayContainerDef(mmodel=self.mmodel,reports= [linstance,self])</span>
    
        <span class="c1"># Create a new DisplayDef with the combined specifications</span>
        <span class="k">return</span> <span class="n">out</span> 




    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines two DisplayDef instances into a new DisplayDef with combined specifications.</span>
<span class="sd">    </span>
<span class="sd">        :param other: Another DisplayDef instance to add.</span>
<span class="sd">        :return: A new DisplayDef instance with merged specifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
    
        <span class="c1"># Combine options using the existing __add__ method of DisplaySpec</span>
        <span class="n">new_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">spec</span>
    
        <span class="c1"># Merge names if they differ, separated by a comma</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    
        <span class="c1"># Create a new DisplayDef with the combined specifications</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">new_spec</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s1">&#39;latex&#39;</span><span class="p">):</span>
            <span class="c1"># If the other object is an instance of LaTeXHolder, concatenate their LaTeX strings</span>
            <span class="k">return</span> <span class="n">LatexRepo</span><span class="p">(</span><span class="n">latex</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">latex</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">latex</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># If the other object is a string, assume it&#39;s a raw LaTeX string and concatenate</span>
            <span class="k">return</span> <span class="n">LatexRepo</span><span class="p">(</span><span class="n">latex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">DisplayLatexDef</span><span class="p">(</span><span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">latex_text</span><span class="o">=</span><span class="n">other</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span><span class="o">.</span><span class="n">latex</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the other object is neither a LaTeXHolder instance nor a string, raise an error</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only add another LaTeXHolder instance or a raw LaTeX string.&quot;</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># If the left-hand side operand is a string, this method will be called</span>
            <span class="k">return</span> <span class="n">LatexRepo</span><span class="p">(</span><span class="n">latex</span> <span class="o">=</span>    <span class="n">DisplayLatexDef</span><span class="p">(</span><span class="n">spec</span> <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">latex_text</span><span class="o">=</span><span class="n">other</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span><span class="o">.</span><span class="n">latex</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Handling unexpected types gracefully</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Left operand must be a string for LaTeX concatenation.&quot;</span><span class="p">)</span>
            
        
 
        
                
    
    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_html</span><span class="p">)</span>

      

<div class="viewcode-block" id="DisplayDef.set_options">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayDef.set_options">[docs]</a>
    <span class="k">def</span> <span class="nf">set_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">+</span> <span class="n">kwargs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#We want to keep the smpl which shere used originaly if it is a tab</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">set_smpl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">spec</span><span class="o">=</span> <span class="n">spec</span><span class="p">)</span> 
        <span class="k">except</span><span class="p">:</span> 
                <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">spec</span><span class="o">=</span> <span class="n">spec</span><span class="p">)</span> 

        <span class="k">return</span> <span class="n">out</span> </div>


<div class="viewcode-block" id="DisplayDef.figwrap">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayDef.figwrap">[docs]</a>
    <span class="k">def</span> <span class="nf">figwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chart</span><span class="p">,</span><span class="n">pgf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">latex_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">pgf</span><span class="p">:</span> 
            <span class="n">out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39; </span>
<span class="s1">\begin</span><span class="si">{figure}</span><span class="s1">[htbp]</span>
<span class="s1">\centering</span>
<span class="s1">\resizebox{\textwidth}{!}&#39;&#39;&#39;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;{\input{&#39;</span> <span class="o">+</span><span class="sa">fr</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">latex_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">chart</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s1">.pgf&quot;&#39;</span><span class="o">+</span><span class="s1">&#39;}}&#39;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">\caption</span><span class="se">{{</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">titledic</span><span class="p">[</span><span class="n">chart</span><span class="p">]</span><span class="si">}</span><span class="se">}}</span>
<span class="s1">\end</span><span class="se">{{</span><span class="s1">figure</span><span class="se">}}</span><span class="s1"> &#39;&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># for pandoc and word </span>
            <span class="n">out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39; </span>
<span class="s1">\begin</span><span class="si">{figure}</span><span class="s1">[htbp]</span>
<span class="s1">\centering</span>
<span class="s1">&#39;&#39;&#39;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\includegraphics[width=\textwidth]{&#39;</span> <span class="o">+</span><span class="sa">fr</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">latex_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">chart</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s1">.png&quot;&#39;</span><span class="o">+</span><span class="s1">&#39;}&#39;</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">titledic</span><span class="p">[</span><span class="n">chart</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">)</span> 
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">\caption</span><span class="se">{{</span><span class="si">{</span><span class="n">caption</span><span class="si">}</span><span class="se">}}</span>
<span class="s1">\end</span><span class="se">{{</span><span class="s1">figure</span><span class="se">}}</span><span class="s1"> &#39;&#39;&#39;</span>



        <span class="k">return</span> <span class="n">out</span></div>
</div>





<div class="viewcode-block" id="LatexRepo">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.LatexRepo">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LatexRepo</span><span class="p">:</span>
    <span class="n">latex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;latex_test&#39;</span>
    
<div class="viewcode-block" id="LatexRepo.set_name">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.LatexRepo.set_name">[docs]</a>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    
<div class="viewcode-block" id="LatexRepo.latexwrap">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.LatexRepo.latexwrap">[docs]</a>
    <span class="k">def</span> <span class="nf">latexwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
         
        <span class="n">latex_pre</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;\documentclass</span><span class="si">{article}</span>
<span class="s1">\usepackage</span><span class="si">{booktabs}</span>
<span class="s1">\usepackage</span><span class="si">{caption}</span><span class="s1"> % Include the caption package</span>
<span class="s1">\captionsetup{justification=raggedright,singlelinecheck=false}</span>
<span class="s1">\usepackage</span><span class="si">{graphicx}</span>
<span class="s1">\usepackage</span><span class="si">{pgf}</span>
<span class="s1">\usepackage</span><span class="si">{lscape}</span>
<span class="s1">\begin</span><span class="si">{document}</span>

<span class="s1">&#39;&#39;&#39;</span>
        
        <span class="n">latex_post</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">\end</span><span class="si">{document}</span>
<span class="s1">        &#39;&#39;&#39;</span>   
        <span class="n">out</span> <span class="o">=</span> <span class="n">latex_pre</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex</span> <span class="o">+</span> <span class="n">latex_post</span> 
        <span class="k">return</span> <span class="n">out</span> </div>

    
 
  
<div class="viewcode-block" id="LatexRepo.pdf">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.LatexRepo.pdf">[docs]</a>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pdfopen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span>
            <span class="n">typesetter</span><span class="o">=</span><span class="s1">&#39;xelatex  -interaction=batchmode -no-shell-escape &#39;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a PDF file from the LaTeX content and optionally displays it.</span>
<span class="sd">    </span>
<span class="sd">        This method creates a directory for LaTeX files, writes the LaTeX content </span>
<span class="sd">        to a `.tex` file, and uses a specified typesetter to compile it into a PDF. </span>
<span class="sd">        The resulting PDF can be displayed in an `IFrame` or opened in the default </span>
<span class="sd">        PDF viewer.</span>
<span class="sd">        </span>
<span class="sd">        Requires that miktex or another appropiate latex framework is installed.</span>
<span class="sd">        </span>
<span class="sd">        Inspect the latex source by specifying: typesetter=&#39;texworks&#39;</span>
<span class="sd">        </span>
<span class="sd">        The files are located in the folder called latex/{name}</span>
<span class="sd">        </span>
<span class="sd">         - The .tex file is called {name.tex}</span>
<span class="sd">         - the .pdf file is called {name.pdf} </span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">            pdfopen (bool): If True, opens the generated PDF file in the default viewer.</span>
<span class="sd">            show (bool): If True, shows the pdf as a IFrame in Jupyter notebook .</span>
<span class="sd">            width (int): The width of the `IFrame` if `show` is True.</span>
<span class="sd">            height (int): The height of the `IFrame` if `show` is True.</span>
<span class="sd">            typesetter (str): The LaTeX engine to use for compilation (e.g., &#39;xelatex (default), pdflatex, texworks or latexmk&#39;).</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            IFrame: An iframe displaying the PDF file if `show` is True.</span>
<span class="sd">    </span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: If the typesetter returns a non-zero exit code, indicating an error </span>
<span class="sd">            in generating the PDF. Opens the directory containing the LaTeX file for inspection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
     
        
        
        <span class="n">latex_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;latex/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">latex_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">latex_file</span> <span class="o">=</span> <span class="n">latex_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.tex&#39;</span>        
        <span class="n">pdf_file</span> <span class="o">=</span> <span class="n">latex_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.pdf&#39;</span>
        
        <span class="n">latex_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     
        <span class="n">pdf_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


        

        <span class="c1"># Now open the file for writing within the newly created directory</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">latex_file</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latexwrap</span><span class="p">())</span>  <span class="c1"># Assuming tab.fulllatexwidget is the content you want to write</span>
            
            
         <span class="c1"># xx0 = run(f&#39;pdflatex  {self.name}.tex&#39;      ,cwd = f&#39;{latex_dir}&#39;)</span>
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">xx0</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">typesetter</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.tex&#39;</span>      <span class="p">,</span><span class="n">cwd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">latex_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Catch the FileNotFoundError and print a message</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The typesetter &quot;</span><span class="si">{</span><span class="n">typesetter</span><span class="si">}</span><span class="s1">&quot; was not found. Please check the name and file path and try again.&#39;</span><span class="p">)</span>
            
            <span class="k">return</span> 
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Catch any other exceptions</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preparing PDF file an unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> 

        <span class="c1"># xx0 = run(f&#39;latexmk -pdf -dvi- -ps- -f {self.name}.tex&#39;      ,cwd = f&#39;{latex_dir}&#39;)</span>
        <span class="k">if</span> <span class="n">xx0</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span> 
             <span class="n">wb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">latex_dir</span><span class="o">.</span><span class="n">absolute</span><span class="p">(),</span> <span class="n">new</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
 
             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error creating PDF file, </span><span class="si">{</span><span class="n">xx0</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s1">, look in the latex file, </span><span class="si">{</span><span class="n">latex_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
             
        <span class="k">if</span> <span class="n">pdfopen</span><span class="p">:</span>
            <span class="n">fileurl</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;file://</span><span class="si">{</span><span class="n">pdf_file</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="c1"># print(fileurl)</span>
            <span class="n">wb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileurl</span> <span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
             
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">IFrame</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span></div>



    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">other_latex</span> <span class="o">=</span> <span class="n">DisplayLatexDef</span><span class="p">(</span><span class="n">spec</span> <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">latex_text</span><span class="o">=</span><span class="n">other</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span><span class="o">.</span><span class="n">latex</span> 

        <span class="k">else</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s1">&#39;latex&#39;</span><span class="p">):</span>
                <span class="n">other_latex</span><span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">latex</span> 
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Trying to join latex from object without latex content &#39;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span>  <span class="n">LatexRepo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latex</span> <span class="o">+</span> <span class="n">other_latex</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span> 

    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># If the left-hand side operand is a string, this method will be called</span>
            <span class="k">return</span> <span class="n">LatexRepo</span><span class="p">(</span><span class="n">latex</span><span class="o">=</span><span class="n">DisplayLatex</span><span class="p">(</span><span class="n">spec</span> <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">latex_text</span><span class="o">=</span><span class="n">other</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span><span class="o">.</span><span class="n">latex</span>  <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Handling unexpected types gracefully</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Left operand must be a string for LaTeX concatenation.&quot;</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">pdf_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;latex/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;iframe src=&quot;</span><span class="si">{</span><span class="n">pdf_file</span><span class="si">}</span><span class="s1">&quot; width=</span><span class="si">{</span><span class="n">WIDTH</span><span class="si">}</span><span class="s1"> height=</span><span class="si">{</span><span class="n">HEIGHT</span><span class="si">}</span><span class="s1">&gt;&lt;/iframe&gt;&#39;</span></div>

 
    
<span class="n">DisplayDef</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">LatexRepo</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="vm">__doc__</span>    


<div class="viewcode-block" id="DisplayVarTableDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayVarTableDef">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplayVarTableDef</span><span class="p">(</span><span class="n">DisplayDef</span><span class="p">):</span>
    
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>  <span class="c1"># Call the parent class&#39;s __post_init__</span>

        
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">set_smpl</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">smpl</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">make_var_df</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">report_smpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_smpl</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="o">...</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span>     <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="p">)</span> 
            <span class="c1"># assert 1==2</span>
        <span class="k">return</span> 

<div class="viewcode-block" id="DisplayVarTableDef.make_var_df">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayVarTableDef.make_var_df">[docs]</a>
    <span class="k">def</span> <span class="nf">make_var_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>   
        <span class="n">showtype</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">showtype</span>
        <span class="n">diftype</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span>
        
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">keepswitch</span><span class="p">(</span><span class="n">switch</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> 

            <span class="c1"># Pre-process for cases that use linevars and linedes</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">textlinetype</span>  <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;textline&#39;</span><span class="p">]:</span>                
                <span class="n">linedf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">centertext</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unitline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">centertext</span>
            <span class="k">else</span><span class="p">:</span>                    
                <span class="k">def</span> <span class="nf">getline</span><span class="p">(</span><span class="n">start_ofset</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kvargs</span><span class="p">):</span>
                    <span class="n">locallinedfdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">keep_get_plotdict_new</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">pat</span><span class="p">,</span><span class="n">showtype</span><span class="o">=</span><span class="n">showtype</span><span class="p">,</span>
                                    <span class="n">diftype</span> <span class="o">=</span> <span class="n">diftype</span><span class="p">,</span><span class="n">by_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">diftype</span> <span class="o">==</span> <span class="s1">&#39;basedf&#39;</span><span class="p">:</span>
                        <span class="n">locallinedf</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">((</span><span class="n">locallinedfdict</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span><span class="o">.</span><span class="n">T</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">locallinedf</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">locallinedfdict</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span><span class="o">.</span><span class="n">T</span>
                        
                    <span class="k">return</span> <span class="n">locallinedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">]</span> 
                
                <span class="c1"># print(line.mul)</span>
                
                
                
                <span class="n">linedf</span> <span class="o">=</span> <span class="n">getline</span><span class="p">()</span> <span class="o">*</span> <span class="n">line</span><span class="o">.</span><span class="n">mul</span>
            <span class="n">linedf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rowdes</span><span class="p">(</span><span class="n">linedf</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>    
            
        <span class="k">return</span><span class="p">(</span><span class="n">linedf</span><span class="p">)</span></div>


            
    

    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">df_str_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">width</span>
        <span class="c1"># df = self.df.copy( )</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dec</span> 
            <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> 
            <span class="c1"># df_char = pd.DataFrame(&#39; &#39;, index=self.thisdf.index, columns=self.thisdf.columns)</span>
            <span class="n">df_char</span> <span class="o">=</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_char</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    
            <span class="n">format_decimal</span> <span class="o">=</span> <span class="p">[</span>  <span class="n">line</span><span class="o">.</span><span class="n">dec</span> <span class="k">for</span> <span class="n">line</span><span class="p">,</span><span class="n">df</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">format_decimal</span><span class="p">):</span>
                  <span class="n">df_char</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">)</span>
      
        <span class="k">return</span>  <span class="n">df_char</span>   

    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">df_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">width</span>
        <span class="c1"># df = self.df.copy( )</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dec</span> 
            <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> 
            <span class="n">df_char</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">thisdf</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">thisdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df_char</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_char</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    
            <span class="n">format_decimal</span> <span class="o">=</span> <span class="p">[</span>  <span class="n">line</span><span class="o">.</span><span class="n">dec</span> <span class="k">for</span> <span class="n">line</span><span class="p">,</span><span class="n">df</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">format_decimal</span><span class="p">):</span>
                  <span class="n">df_char</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">width</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">)</span>
      
        <span class="k">return</span>  <span class="n">df_char</span>   



    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">df_str_disp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">textlinetype</span> <span class="o">==</span> <span class="s1">&#39;textline&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">centertext</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>  <span class="k">for</span> <span class="n">line</span><span class="p">,</span><span class="n">df</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
        <span class="n">center_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">center</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span><span class="p">]</span>

        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">width</span>
        <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span> 
            
        <span class="n">rawdata</span> <span class="o">=</span> <span class="n">thisdf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">max_cols</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_cols</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">center_title_under_years</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span><span class="n">center_index</span><span class="p">)</span>
        <span class="c1"># print(*data,sep=&#39;\n&#39;)</span>
        <span class="c1"># rawdata[0],rawdata[1] = rawdata[1],rawdata[0]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>       

    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">df_str_disp_transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        
        <span class="n">rawdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">max_cols</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_cols</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unitline</span> <span class="p">]</span> <span class="o">+</span><span class="n">rawdata</span> 
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">center_title_under_years</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">title_row_index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">year_row_index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>       


    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str_disp_transpose</span>  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span> <span class="k">else</span>  <span class="bp">self</span><span class="o">.</span><span class="n">df_str_disp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span>

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">sheetwidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_html</span><span class="p">]</span> 

    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">out_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

       
    
        <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">htmlwidget</span><span class="p">)</span>     

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">htmlwidget_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span> 
            <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span>             
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">textlinetype</span> <span class="o">==</span> <span class="s1">&#39;textline&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">centertext</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>  <span class="k">for</span> <span class="n">line</span><span class="p">,</span><span class="n">df</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>

            
        <span class="n">outsty</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">make_html_style</span><span class="p">(</span><span class="n">thisdf</span><span class="p">)</span>  
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> 
            <span class="n">outsty</span> <span class="o">=</span> <span class="n">outsty</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">add_footer_to_styler</span><span class="p">(</span><span class="n">outsty</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">outsty</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">na_rep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">insert_centered_row</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">unitline</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    
        <span class="k">return</span> <span class="n">out</span>    

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">htmlwidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="n">endhtml</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">tab_to_html</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">endhtml</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">html_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">ibsstyle</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">use_tooltip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span> 
            <span class="n">splitted_html</span> <span class="o">=</span> <span class="n">HTMLSplitData</span><span class="p">(</span><span class="n">html_all</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">caption</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;caption&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">&lt;/caption&gt;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> 
                <span class="n">out</span> <span class="o">=</span> <span class="n">splitted_html</span><span class="o">.</span><span class="n">text_before_thead</span> <span class="o">+</span> <span class="n">caption</span> <span class="o">+</span> <span class="s1">&#39;&lt;thead&gt;&#39;</span> <span class="o">+</span> <span class="n">splitted_html</span><span class="o">.</span><span class="n">thead</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                
                
                <span class="n">endhtml</span> <span class="o">=</span> <span class="n">splitted_html</span><span class="o">.</span><span class="n">text_after_tbody</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">textlinetype</span> <span class="o">==</span> <span class="s1">&#39;textline&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">centertext</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span> <span class="p">):</span>
                <span class="n">col0</span> <span class="o">=</span> <span class="s1">&#39;&lt;tr&gt;&lt;td &lt;th class=&quot;row_heading level0 row0&quot; &gt;  &lt;/td&gt;&#39;</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">col0</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;td colspan=&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; style=&#39;text-align: center;position: sticky; top: 0; background: white; left: 0;&#39;&gt;</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">centertext</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span>

            <span class="k">else</span><span class="p">:</span> 
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">splitted_html</span><span class="o">.</span><span class="n">tbody</span>
                
            <span class="k">return</span> <span class="n">out</span>         
    
    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span> 
            <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span>             
    
            
            <span class="n">outsty</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">make_html_style</span><span class="p">(</span><span class="n">thisdf</span><span class="p">)</span>  
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> 
                <span class="n">outsty</span> <span class="o">=</span> <span class="n">outsty</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">add_footer_to_styler</span><span class="p">(</span><span class="n">outsty</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">outsty</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">na_rep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">insert_centered_row</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">unitline</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>    
           <span class="n">thisdfs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="n">df</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">df</span><span class="p">,</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> 
             <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">))]</span>
            
           <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tab_to_html</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="n">thisdfs</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
           <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span>               
               <span class="n">foot</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;tfoot&gt;&lt;tr&gt;&lt;td colspan=&#39;5&#39; style=&#39;text-align: left;&#39;&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;&quot;</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">foot</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
           
           <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">foot</span> <span class="o">+</span> <span class="s1">&#39;&lt;/table&gt;&#39;</span>     
    
        
    
    
        <span class="k">return</span> <span class="n">out</span>    



    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex_transpose</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">transpose</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex_straight</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latex_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
            <span class="n">last_cols</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="n">rowlines</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">line</span> <span class="k">for</span>  <span class="n">line</span><span class="p">,</span><span class="n">df</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">:</span> 
                <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">:</span>
                    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_cols</span><span class="p">:</span>
                        
                        <span class="n">last_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">last_cols</span> 
                        <span class="n">first_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_cols</span> <span class="o">-</span> <span class="n">last_cols</span>
                    
                        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="n">first_cols</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="n">last_cols</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="p">]</span>
            <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="p">):</span> 
                <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="n">newindex</span> <span class="o">=</span> <span class="p">[</span><span class="sa">fr</span><span class="s1">&#39;&amp;\multicolumn</span><span class="se">{{</span><span class="si">{</span><span class="n">ncol</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{c}</span><span class="s1">{&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">latexfont</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;}}&#39;</span>  
                            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">textlinetype</span> <span class="o">==</span> <span class="s1">&#39;textline&#39;</span>
                            <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rowlines</span><span class="p">)]</span>    
    
                <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">newindex</span>
                <span class="n">tabformat</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span><span class="o">+</span><span class="s1">&#39;r&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="n">last_cols</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span> <span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">+</span><span class="s1">&#39;r&#39;</span><span class="o">*</span><span class="n">last_cols</span><span class="p">)</span> <span class="k">if</span> <span class="n">last_cols</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
                <span class="n">outlist</span> <span class="o">=</span> <span class="n">outlist</span> <span class="o">+</span> <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">)</span> \
                 <span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39; - continued &#39;</span><span class="p">))</span> \
                 <span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">hrules</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;ht&#39;</span><span class="p">,</span> <span class="n">column_format</span><span class="o">=</span><span class="n">tabformat</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;US$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;US\$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\dots&#39;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\caption{&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\caption{&#39;</span><span class="p">)]</span> <span class="c1"># to be used if no numbering </span>
                   
            <span class="c1"># print(outlist)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outlist</span><span class="p">)</span> 
            
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;  &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;multicolum&#39;</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">else</span> <span class="n">l</span>   <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span> 
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;\caption*</span><span class="se">{{</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">landscape</span><span class="p">:</span>
                <span class="n">out</span><span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\begin</span><span class="si">{landscape}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">out</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{landscape}</span><span class="s1">&#39;</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="k">return</span> <span class="n">out</span>       

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latex_transpose_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">multi_df</span>  <span class="o">=</span> <span class="n">create_column_multiindex</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">tabformat</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span><span class="o">+</span><span class="s1">&#39;r&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">multi_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 

        <span class="n">latex_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">multi_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> 
                 <span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">hrules</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;ht&#39;</span><span class="p">,</span> <span class="n">column_format</span><span class="o">=</span><span class="n">tabformat</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;US$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;US\$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\dots&#39;</span><span class="p">)</span> <span class="p">)</span> 
        <span class="n">out</span> <span class="o">=</span> <span class="n">latex_df</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># print(*[f&#39;{i} {d}&#39; for i,d in enumerate(data)],sep=&#39;\n&#39;)</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>       <span class="o">=</span>  <span class="n">data</span> <span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="c1"># print(*[f&#39;{i} {d}&#39; for i,d in enumerate(data)],sep=&#39;\n&#39;)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{r}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{c}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;multicolum&#39;</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">else</span> <span class="n">l</span>   <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\caption{&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\caption{&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span> 
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;\caption*</span><span class="se">{{</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">out</span> 
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latex_transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    
          <span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span><span class="p">,:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeslice</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_str</span>
          <span class="n">tabformat</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span><span class="o">+</span><span class="s1">&#39;r&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">thisdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
    
          <span class="n">latex_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">thisdf</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> 
                   <span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">hrules</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;ht&#39;</span><span class="p">,</span> <span class="n">column_format</span><span class="o">=</span><span class="n">tabformat</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;US$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;US\$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\dots&#39;</span><span class="p">)</span> <span class="p">)</span> 
          <span class="n">out</span> <span class="o">=</span> <span class="n">latex_df</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
          <span class="c1"># print(*[f&#39;{i} {d}&#39; for i,d in enumerate(data)],sep=&#39;\n&#39;)</span>
          
          <span class="n">unit_line_latex</span>  <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;&amp;\multicolumn</span><span class="se">{{</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">thisdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{c}</span><span class="s1">{{&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitline</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;}}</span><span class="se">\\</span><span class="s1">&#39;</span>  
          <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span> <span class="p">[</span><span class="n">unit_line_latex</span><span class="p">]</span>   <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>                  
      
          <span class="c1"># print(*[f&#39;{i} {d}&#39; for i,d in enumerate(data)],sep=&#39;\n&#39;)</span>
          <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
          <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{r}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{c}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;multicolum&#39;</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">else</span> <span class="n">l</span>   <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
          <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\caption{&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\caption{&#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="p">:</span> 
              <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;\caption*</span><span class="se">{{</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">foot</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span><span class="p">)</span>
          
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">landscape</span><span class="p">:</span>
                <span class="n">out</span><span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\begin</span><span class="si">{landscape}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">out</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{landscape}</span><span class="s1">&#39;</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
  
          
          <span class="k">return</span> <span class="n">out</span> 

    <span class="k">def</span> <span class="nf">make_html_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">use_tooltips</span> <span class="o">=</span><span class="kc">False</span> <span class="p">)</span>  <span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">([</span>           
    <span class="p">{</span>
        <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;.row_heading, .corner&#39;</span><span class="p">,</span>
        <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;sticky&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;300px&#39;</span><span class="p">),</span>  <span class="c1"># Set the width of the row headings</span>
            <span class="p">(</span><span class="s1">&#39;min-width&#39;</span><span class="p">,</span> <span class="s1">&#39;200px&#39;</span><span class="p">),</span>  <span class="c1"># Ensure the minimum width is respected</span>
            <span class="p">(</span><span class="s1">&#39;max-width&#39;</span><span class="p">,</span> <span class="s1">&#39;400px&#39;</span><span class="p">)</span>  <span class="c1"># Ensure the maximum width is respected</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;.col_heading&#39;</span><span class="p">,</span>
        <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;sticky&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span>
        <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="c1"># Align text to the left</span>
            <span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">),</span>  <span class="c1"># Ensuring headers are not transparent</span>
               <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>  <span class="c1"># Headers z-index on par with column headings</span>
        <span class="p">]</span>
    <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;td&#39;</span><span class="p">,</span>  <span class="c1"># Targeting data cells</span>
            <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">),</span>  <span class="c1"># Lower z-index than headers</span>
            <span class="p">]</span>
        <span class="p">},</span>
    
    
    <span class="p">{</span>
        <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;caption&#39;</span><span class="p">,</span>
        <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;16px&#39;</span><span class="p">),</span>  <span class="c1"># Make the font larger</span>
            <span class="p">(</span><span class="s1">&#39;font-weight&#39;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>  <span class="c1"># Make the font bold</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_tooltips</span><span class="p">:</span>
                <span class="n">tt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="p">]</span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
                <span class="k">try</span><span class="p">:</span>
                   <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">set_tooltips</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s1">&#39;visibility: hidden; position: absolute; z-index: 1; border: 1px solid #000066;&#39;</span>
                                <span class="s1">&#39;background-color: white; color: #000066; font-size: 0.8em;width:100%&#39;</span>
                                <span class="s1">&#39;transform: translate(0px, -24px); padding: 0.6em; border-radius: 0.5em;&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> 
                    <span class="o">...</span>       
        <span class="n">out</span><span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">out</span> 
    
<div class="viewcode-block" id="DisplayVarTableDef.make_html_style">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayVarTableDef.make_html_style">[docs]</a>
    <span class="k">def</span> <span class="nf">make_html_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">use_tooltips</span> <span class="o">=</span><span class="kc">False</span> <span class="p">)</span>  <span class="p">:</span>
        <span class="c1"># out = self.mmodel.ibsstyle(self.df_str,use_tooltip=False)          </span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">ibsstyle</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">use_tooltip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>          
                                   
        <span class="k">return</span> <span class="n">out</span> </div>
</div>

    

<div class="viewcode-block" id="DisplayKeepFigDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayKeepFigDef">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplayKeepFigDef</span><span class="p">(</span><span class="n">DisplayDef</span><span class="p">):</span>
    
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>  <span class="c1"># Call the parent class&#39;s __post_init__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">scenarios</span>
        <span class="c1"># print(self.options.scenarios)</span>
        <span class="c1"># print(self.base_last)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">keepswitch</span><span class="p">(</span><span class="n">scenarios</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">scenarios</span><span class="p">,</span><span class="n">base_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span><span class="p">):</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">set_smpl</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">smpl</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_df</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">]</span> 
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">figs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_figs</span><span class="p">(</span><span class="n">showfig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report_smpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_smpl</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">chart_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
        
        

        

        <span class="k">return</span> 
    
            
<div class="viewcode-block" id="DisplayKeepFigDef.make_df">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayKeepFigDef.make_df">[docs]</a>
    <span class="k">def</span> <span class="nf">make_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>   
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">textlinetype</span>  <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;textline&#39;</span><span class="p">]:</span>                
            <span class="c1"># textdf = pd.DataFrame(float(&#39;nan&#39;), index=self.mmodel.current_per, columns=[line.centertext]).T</span>
            <span class="n">outlist</span> <span class="o">=</span> <span class="p">[]</span>    
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">locallinedfdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">keep_get_plotdict_new</span><span class="p">(</span>
                               <span class="n">pat</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">pat</span><span class="p">,</span>
                               <span class="n">showtype</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">showtype</span><span class="p">,</span>
                               <span class="n">diftype</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span><span class="p">,</span>
                               <span class="n">by_var</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">by_var</span><span class="p">)</span>
            
            <span class="c1"># print(f&#39;before {locallinedfdict.keys()=}&#39;)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span> <span class="o">==</span> <span class="s1">&#39;basedf&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">by_var</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span> <span class="o">==</span> <span class="s1">&#39;basedf&#39;</span><span class="p">:</span>
                        <span class="n">locallinedfdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="n">locallinedfdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">locallinedfdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="n">locallinedfdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span> <span class="o">==</span> <span class="s1">&#39;basedf&#39;</span><span class="p">:</span>
                        <span class="n">first_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">locallinedfdict</span><span class="p">))</span>    <span class="c1"># First key</span>
                        <span class="n">locallinedfdict</span> <span class="o">=</span>  <span class="p">{</span><span class="n">first_key</span><span class="p">:</span> <span class="n">locallinedfdict</span><span class="p">[</span><span class="n">first_key</span><span class="p">]}</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">last_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">locallinedfdict</span><span class="p">))</span> <span class="c1"># Last key</span>
                        <span class="n">locallinedfdict</span> <span class="o">=</span>  <span class="p">{</span><span class="n">last_key</span><span class="p">:</span> <span class="n">locallinedfdict</span><span class="p">[</span><span class="n">last_key</span><span class="p">]}</span>
                        
                    

            <span class="c1"># print(f&#39;after {locallinedfdict.keys()=}&#39;)</span>

            <span class="n">outlist</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;line&#39;</span><span class="p">:</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">k</span> <span class="p">,</span>
                            <span class="s1">&#39;df&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rowdes</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:],</span><span class="n">line</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
                            <span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="n">locallinedfdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="p">]</span>    
            
        <span class="k">return</span><span class="p">(</span><span class="n">outlist</span><span class="p">)</span></div>


<div class="viewcode-block" id="DisplayKeepFigDef.make_figs">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayKeepFigDef.make_figs">[docs]</a>
    <span class="k">def</span> <span class="nf">make_figs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">showfig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># def keep_plot(self, pat=&#39;*&#39;, start=&#39;&#39;, end=&#39;&#39;, start_ofset=0, end_ofset=0, showtype=&#39;level&#39;,</span>
    <span class="c1">#       diff=False, diffpct=False, mul=1.0, title=&#39;Scenarios&#39;, legend=False, scale=&#39;linear&#39;,</span>
    <span class="c1">#       yunit=&#39;&#39;, ylabel=&#39;&#39;, dec=&#39;&#39;, trans=None, showfig=True, kind=&#39;line&#39;, size=(10, 6),</span>
    <span class="c1">#       vline=None, savefig=&#39;&#39;, by_var=True, dataonly=False, samefig=False, ncol=2):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate and display plots for specified scenarios and variables.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of Matplotlib figures, with keys being the variable names and values being the figure objects.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ZeroDivisionError: If no kept solution is available for plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Function implementation...</span>

    <span class="c1"># Function implementation...</span>

         <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span> 

            
         <span class="n">dfsres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span>
         
         

         <span class="n">number</span> <span class="o">=</span>  <span class="nb">len</span><span class="p">(</span><span class="n">dfsres</span><span class="p">)</span>
         <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
         
         <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">samefig</span><span class="p">:</span>
             <span class="o">...</span>
             <span class="n">all_by_var</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_var</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dfsres</span><span class="p">])</span>
             <span class="n">xcol</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">ncol</span> 
             <span class="n">xrow</span><span class="o">=-</span><span class="p">((</span><span class="o">-</span><span class="n">number</span> <span class="p">)</span><span class="o">//</span><span class="n">options</span><span class="o">.</span><span class="n">ncol</span><span class="p">)</span>
             <span class="n">figsize</span> <span class="o">=</span>  <span class="p">(</span><span class="n">xcol</span><span class="o">*</span><span class="n">options</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrow</span><span class="o">*</span><span class="n">options</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
             
             <span class="c1"># print(f&#39;{size=}  {figsize=}&#39;)</span>
             <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
             <span class="c1">#gs = gridspec.GridSpec(xrow + 1, xcol, figure=fig)  # One additional row for the legend</span>
             
             <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">legend</span> <span class="ow">and</span> <span class="n">all_by_var</span><span class="p">:</span> 
                 <span class="n">extra_row</span> <span class="o">=</span> <span class="mi">1</span> 
                 <span class="n">row_heights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">xrow</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>  <span class="c1"># Assuming equal height for all plot rows, and half for the legend</span>

             <span class="k">else</span><span class="p">:</span> 
                 <span class="n">extra_row</span> <span class="o">=</span> <span class="mi">0</span> 
                 <span class="n">row_heights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">xrow</span>  <span class="c1"># Assuming equal height for all plot rows,</span>

                 
             <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">xrow</span> <span class="o">+</span> <span class="n">extra_row</span> <span class="p">,</span> <span class="n">xcol</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="n">row_heights</span><span class="p">)</span>

             <span class="n">fig</span><span class="o">.</span><span class="n">set_constrained_layout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create axes for the plots</span>
             <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xrow</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xcol</span><span class="p">)]</span>
             <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">legend</span> <span class="ow">and</span> <span class="n">all_by_var</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span><span class="p">:</span> 
                 <span class="n">legend_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>  <span class="c1"># Span the legend axis across the bottom</span>
             
             <span class="n">figs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="p">:</span> <span class="n">fig</span><span class="p">}</span>

         <span class="k">else</span><span class="p">:</span>
             <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
                 <span class="n">keys</span> <span class="o">=</span> <span class="n">format_list_with_numbers</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_description</span><span class="p">[</span><span class="n">dr</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">dr</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">showtype</span><span class="si">}</span><span class="s1"> &#39;</span><span class="o">+</span>
                                                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dr</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diftype</span><span class="si">}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;nodif&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">dfsres</span> <span class="p">])</span>
                 <span class="c1">#print(f&#39;{keys}=&#39;)</span>
             <span class="k">else</span><span class="p">:</span>
                 <span class="n">keys</span> <span class="o">=</span> <span class="n">format_list_with_numbers</span><span class="p">([</span><span class="n">dr</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">dr</span> <span class="ow">in</span> <span class="n">dfsres</span> <span class="p">])</span>
             <span class="o">...</span> 
             <span class="c1"># figs_and_ax  = {f&#39;{self.name}_{i}&#39; :  plt.subplots(figsize=options.size) for i,v  in enumerate(dfsres)}</span>
             <span class="n">figs_and_ax</span>  <span class="o">=</span> <span class="p">{</span><span class="n">v</span>  <span class="p">:</span>  <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>  <span class="n">keys</span><span class="p">}</span>
             <span class="n">figs</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span> <span class="p">:</span> <span class="n">fig</span> <span class="k">for</span> <span class="n">v</span><span class="p">,(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>   <span class="ow">in</span> <span class="n">figs_and_ax</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span> 
             <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span>    <span class="n">ax</span>  <span class="k">for</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>    <span class="ow">in</span> <span class="n">figs_and_ax</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">]</span> 
         
         
         <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfsres</span><span class="p">):</span>
             <span class="n">v</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
             <span class="n">df</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span>
             <span class="n">line</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span>
             
             <span class="n">mul</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">mul</span>
             <span class="n">by_var</span><span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">by_var</span>
             <span class="n">aspct</span> <span class="o">=</span> <span class="s1">&#39; as pct &#39;</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;difpct&#39;</span><span class="p">}</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span>
             <span class="n">dftype</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">showtype</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
             <span class="n">dec</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">dec</span> 
             
             <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Percent&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">showtype</span> <span class="ow">in</span> <span class="p">{</span> <span class="s1">&#39;growth&#39;</span><span class="p">,</span><span class="s1">&#39;gdppct&#39;</span><span class="p">}</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span> <span class="o">==</span> <span class="s1">&#39;difpct&#39;</span> <span class="p">)</span>  <span class="k">else</span> <span class="s1">&#39;&#39;</span>
             
             <span class="c1"># if by_var: </span>
             <span class="c1">#     pretitle = (f&#39;Difference{aspct}to &quot;{list(self.mmodel.keep_solutions.keys())[0] }&quot; for {dftype}:&#39; </span>
             <span class="c1">#     if (line.diftype in {&#39;difpct&#39;, &#39;dif&#39;}) else f&#39;{dftype}:&#39;)</span>
             <span class="c1"># else:</span>
             <span class="c1">#     pretitle = (f&#39;Difference{aspct}to &quot;{df.columns[0] }&quot; for {dftype}:&#39; </span>
             <span class="c1">#     if (line.diftype in {&#39;difpct&#39;,&#39;dif&#39;}) else f&#39;{dftype}:&#39;)</span>

             
             <span class="n">compare</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">keep_solutions</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">by_var</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span> 
             <span class="n">var_name</span> <span class="o">=</span> <span class="n">v</span>
             <span class="n">var_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_description</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
             
             <span class="n">default_title</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">default_ax_title_template_df</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span>  <span class="k">else</span> <span class="n">line</span><span class="o">.</span><span class="n">default_ax_title_template</span> 
             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span><span class="p">:</span>
                 <span class="n">ax_title_template</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ax_title_template</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">ax_title_template</span> <span class="k">else</span> <span class="n">line</span><span class="o">.</span><span class="n">default_ax_title_template_df</span>
             <span class="k">else</span><span class="p">:</span>
                 <span class="n">ax_title_template</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ax_title_template</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">ax_title_template</span> <span class="k">else</span> <span class="n">line</span><span class="o">.</span><span class="n">default_ax_title_template</span>

             <span class="n">ax_title</span> <span class="o">=</span><span class="n">ax_title_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="n">compare</span><span class="p">,</span><span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="p">,</span><span class="n">var_description</span><span class="o">=</span><span class="n">var_description</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

             <span class="c1"># print(v,ax_title_template)    </span>
             <span class="c1"># title=(f&#39;Difference{aspct}to &quot;{df.columns[0] if not by_var else list(self.mmodel.keep_solutions.keys())[0] }&quot; for {dftype}:&#39; </span>
             <span class="c1"># if (line.diftype in {&#39;difpct&#39;}) else f&#39;{dftype}:&#39;)</span>

             <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">plot_basis_ax</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span> <span class="p">,</span> <span class="n">df</span><span class="o">*</span><span class="n">mul</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">legend</span><span class="p">,</span>
                                     <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_description</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">rename</span> <span class="k">else</span> <span class="p">{},</span>
                                     <span class="n">ax_title</span> <span class="o">=</span> <span class="n">ax_title</span> <span class="p">,</span>
                                     <span class="n">yunit</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">yunit</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Percent&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">showtype</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;growth&#39;</span><span class="p">,</span><span class="s1">&#39;gdppct&#39;</span><span class="p">}</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">diftype</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;difpct&#39;</span><span class="p">})</span><span class="k">else</span> <span class="n">ylabel</span><span class="p">,</span>
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">kind</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">kind</span> <span class="p">,</span><span class="n">samefig</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">samefig</span> <span class="ow">and</span> <span class="n">all_by_var</span><span class="p">,</span>
                                     <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">)</span>
             
             <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">legend</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span> <span class="ow">and</span>  <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                 <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
                 
         <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="n">number</span><span class="p">:]:</span>
             <span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

         
         <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">samefig</span><span class="p">:</span> 
             <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span> <span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 

             <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">legend</span>  <span class="ow">and</span> <span class="n">all_by_var</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_last</span><span class="p">:</span> 
                 <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>  <span class="c1"># Assuming the first ax has the handles and labels</span>
                 <span class="n">legend_ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span> <span class="k">if</span> <span class="kc">True</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                 <span class="n">legend_ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># Hide the axis</span>

         <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span><span class="p">,</span><span class="n">fig</span> <span class="ow">in</span> <span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> 
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">title</span> <span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 

         
         
         <span class="k">if</span> <span class="n">showfig</span><span class="p">:</span>
             <span class="o">...</span>
             <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">figs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> 
                 <span class="n">display</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                 <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span> 

         
         <span class="k">return</span> <span class="n">figs</span></div>

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">latex_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">samefig</span><span class="p">:</span> 
            <span class="n">chart</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">titledic</span> <span class="o">=</span> <span class="p">{</span><span class="n">chart</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">title</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>     
            <span class="bp">self</span><span class="o">.</span><span class="n">titledic</span> <span class="o">=</span> <span class="p">{</span><span class="n">chart</span><span class="p">:</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>  <span class="k">for</span> <span class="n">chart</span><span class="p">,</span><span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
    
            <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1">##  pgf may not work in new version of matplotlib </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">savefigs</span><span class="p">(</span><span class="n">figs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="p">,</span> <span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;./latex&#39;</span><span class="p">,</span>
              <span class="n">experimentname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="p">,</span><span class="n">extensions</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">],</span>
            <span class="c1">#  experimentname = self.name ,extensions= [&#39;png&#39;,&#39;pgf&#39;],</span>
              <span class="n">xopen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">samefig</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">titledic</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>

        
        
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">figwrap</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span> <span class="k">for</span> <span class="n">chart</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span> 

<div class="viewcode-block" id="DisplayKeepFigDef.savefigs">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayKeepFigDef.savefigs">[docs]</a>
    <span class="k">def</span> <span class="nf">savefigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Saves a collection of matplotlib figures to a specified directory.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - location (str): The base folder in which to save the charts. Defaults to &#39;./graph&#39;.</span>
<span class="sd">        - experimentname (str): A subfolder under &#39;location&#39; where charts are saved. Defaults to &#39;experiment1&#39;.</span>
<span class="sd">        - addname (str): An additional name added to each figure filename. Defaults to an empty string.</span>
<span class="sd">        - extensions (list): A list of string file extensions for saving the figures. Defaults to [&#39;svg&#39;].</span>
<span class="sd">        - xopen (bool): If True, open the saved figure locations in a web browser.</span>

<span class="sd">        Returns:</span>
<span class="sd">        str: The absolute path to the folder where figures are saved.</span>

<span class="sd">        Raises:</span>
<span class="sd">        Exception: If the folder cannot be created or a figure cannot be saved/opened.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">savefigs</span><span class="p">(</span><span class="n">figs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

        
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">sheetwidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_html</span> <span class="p">]</span>
    
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">out_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">figlist</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span> <span class="n">htmlwidget_fig</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tabwidget</span><span class="p">(</span><span class="n">figlist</span><span class="p">,</span><span class="n">tab</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">selected_index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">datawidget</span> 
    
    
    <span class="c1"># def _ipython_display_(self):</span>
    <span class="c1">#     display(self.out_html)</span>
            
        <span class="c1"># display(self.out_html)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> 
            <span class="n">display</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

        
        
<div class="viewcode-block" id="DisplayTextDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayTextDef">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplayTextDef</span><span class="p">(</span><span class="n">DisplayDef</span><span class="p">):</span>
    
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>  <span class="c1"># Call the parent class&#39;s __post_init__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latex_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">latex_text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_text</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">html_text</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">text_text</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">text_text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markdown_text</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markdown_text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_smpl</span> <span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Combines two DisplayDef instances into a new DisplayDef with combined specifications.</span>
<span class="sd">     </span>
<span class="sd">         :param other: Another DisplayDef instance to add.</span>
<span class="sd">         :return: A new DisplayDef instance with merged specifications.</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                 <span class="n">out</span> <span class="o">=</span> <span class="n">get_DisplayTextDef</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

         <span class="k">elif</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                 <span class="n">out</span> <span class="o">=</span> <span class="n">other</span>
         <span class="k">else</span><span class="p">:</span>         
                 <span class="k">return</span> <span class="bp">NotImplemented</span>
     
         <span class="c1"># Combine options using the existing __add__ method of DisplaySpec</span>

         <span class="c1"># Merge names if they differ, separated by a comma</span>
         <span class="n">new_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">out</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
         <span class="n">new_spec</span>  <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">Options</span><span class="p">(</span>
             <span class="n">text_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text_text</span> <span class="o">+</span> <span class="n">out</span><span class="o">.</span><span class="n">text_text</span>  <span class="p">,</span>
             <span class="n">html_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">html_text</span> <span class="o">+</span> <span class="n">out</span><span class="o">.</span><span class="n">html_text</span><span class="p">,</span>
             <span class="n">latex_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">latex_text</span> <span class="o">+</span> <span class="n">out</span><span class="o">.</span><span class="n">latex_text</span><span class="p">,</span> 
             <span class="n">markdown_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">markdown_text</span> <span class="o">+</span> <span class="n">out</span><span class="o">.</span><span class="n">markdown_text</span><span class="p">,</span>
             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;some_text&#39;</span><span class="p">))</span>
         <span class="c1"># Create a new DisplayDef with the combined specifications</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">new_spec</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">)</span>

 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex_text</span>
    
  

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">out_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_text</span><span class="p">)</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">sheetwidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tablist</span>   <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_html</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tablist</span>
       


    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_text</span><span class="p">)</span></div>

        

        
<div class="viewcode-block" id="DisplayContainerDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayContainerDef">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplayContainerDef</span><span class="p">:</span>
    <span class="n">mmodel</span>      <span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DisplayDef</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Report_test&#39;</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines two DisplayDef instances into a new DisplayDef with combined specifications.</span>
<span class="sd">    </span>
<span class="sd">        :param other: Another DisplayDef instance to add.</span>
<span class="sd">        :return: A new DisplayDef instance with merged specifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span> <span class="o">+</span> <span class="p">[</span><span class="n">get_DisplayTextDef</span><span class="p">(</span><span class="n">other</span><span class="p">)])</span>

        <span class="k">else</span><span class="p">:</span> 
            <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span> <span class="o">+</span> <span class="p">[</span><span class="n">other</span><span class="p">])</span>
    
        <span class="c1"># Create a new DisplayDef with the combined specifications</span>
        <span class="k">return</span> <span class="n">out</span> 


<div class="viewcode-block" id="DisplayContainerDef.set_name">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayContainerDef.set_name">[docs]</a>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span> </div>


<div class="viewcode-block" id="DisplayContainerDef.set_scenarios">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayContainerDef.set_scenarios">[docs]</a>
    <span class="k">def</span> <span class="nf">set_scenarios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scenarios</span><span class="p">):</span>
       <span class="n">rs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">scenarios</span><span class="o">=</span><span class="n">scenarios</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">]</span>
       <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span><span class="o">=</span> <span class="n">rs</span><span class="p">)</span>

       <span class="k">return</span> <span class="n">out</span>   </div>



    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">latex</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">out</span>
    
<div class="viewcode-block" id="DisplayContainerDef.pdf">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayContainerDef.pdf">[docs]</a>
    <span class="k">def</span> <span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pdfopen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span><span class="n">typesetter</span><span class="o">=</span><span class="s1">&#39;xelatex  -interaction=batchmode -no-shell-escape&#39;</span><span class="p">):</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">LatexRepo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latex</span> <span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">repo</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pdfopen</span><span class="p">,</span><span class="n">show</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">typesetter</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spec_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">save_spec</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">]</span>  
        <span class="k">return</span> <span class="n">out</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">save_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">display_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">out</span>
    
     
<div class="viewcode-block" id="DisplayContainerDef.to_json">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayContainerDef.to_json">[docs]</a>
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">display_type</span><span class="p">):</span>

        <span class="n">display_spec_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_type&quot;</span><span class="p">:</span><span class="n">display_type</span><span class="p">,</span>  <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>  <span class="s2">&quot;reports&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">save_spec</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">]</span>  <span class="p">}</span>
        
        <span class="c1"># Serialize the dictionary to a JSON string</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">display_spec_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>


<div class="viewcode-block" id="DisplayContainerDef.reports_restore">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayContainerDef.reports_restore">[docs]</a>
    <span class="nd">@classmethod</span>    
    <span class="k">def</span> <span class="nf">reports_restore</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">mmodel</span><span class="p">,</span><span class="n">json_string</span><span class="p">):</span>
        <span class="n">reports_json_strings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">mmodel</span><span class="o">=</span><span class="n">mmodel</span><span class="p">,</span><span class="n">reports</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_instance_from_json</span><span class="p">(</span><span class="n">mmodel</span><span class="p">,</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reports_json_strings</span><span class="p">[</span><span class="s1">&#39;reports&#39;</span><span class="p">]]</span>  <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span> </div>

        <span class="c1"># print (*[r for r in reports_json_strings[&#39;reports&#39;]],sep=&#39;\n&#39;)     </span>
        
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">show</span>


    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">sheetwidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tablist</span>   <span class="o">=</span> <span class="p">[</span> <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">sheetwidget</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tablist</span>

   

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">out_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reports</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">sheetwidget</span><span class="p">:</span>
                 <span class="n">display</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="c1">#return out.out_html</span>
        
    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_html</span></div>

  
 
<span class="n">DisplayContainerDef</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">LatexRepo</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="vm">__doc__</span>    

                   
<div class="viewcode-block" id="DisplayFigWrapDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.DisplayFigWrapDef">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DisplayFigWrapDef</span><span class="p">(</span><span class="n">DisplayDef</span><span class="p">):</span>
    
    <span class="n">figs</span> <span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">extensions</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span><span class="s1">&#39;pgf&#39;</span><span class="p">])</span>
    
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>  <span class="c1"># Call the parent class&#39;s __post_init__</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">titledic</span> <span class="o">=</span> <span class="p">{</span><span class="n">chart</span><span class="p">:</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>  <span class="k">for</span> <span class="n">chart</span><span class="p">,</span><span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">newfigs</span><span class="o">=</span> <span class="p">{</span><span class="n">chart</span> <span class="p">:</span> <span class="n">fig</span> <span class="k">for</span> <span class="n">chart</span><span class="p">,</span><span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="p">}</span>
        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">newfigs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
            
        <span class="bp">self</span><span class="o">.</span><span class="n">mmodel</span><span class="o">.</span><span class="n">savefigs</span><span class="p">(</span><span class="n">figs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">newfigs</span><span class="p">,</span> <span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;./latex&#39;</span><span class="p">,</span>
              <span class="n">experimentname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="p">,</span><span class="n">extensions</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extensions</span>
              <span class="p">,</span><span class="n">xopen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newfigs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
        
        
        <span class="k">return</span> 
    
        <span class="k">return</span> <span class="n">out</span> 

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">latex_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">figwrap</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span> <span class="k">for</span> <span class="n">chart</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">charts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span> </div>

        

        
<div class="viewcode-block" id="HtmlSplitTable">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.HtmlSplitTable">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">HtmlSplitTable</span><span class="p">:</span>
    <span class="n">html</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_before_tbody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_after_tbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_html</span><span class="p">()</span>

<div class="viewcode-block" id="HtmlSplitTable.split_html">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.HtmlSplitTable.split_html">[docs]</a>
    <span class="k">def</span> <span class="nf">split_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Split HTML text into text before tbody, tbody, and text after tbody</span>
        <span class="n">text_before_tbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">text_after_tbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">text_before_tbody</span><span class="p">,</span> <span class="n">tbody</span><span class="p">,</span> <span class="n">text_after_tbody</span></div>
</div>



<div class="viewcode-block" id="HTMLSplitData">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.HTMLSplitData">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">HTMLSplitData</span><span class="p">:</span>
    <span class="n">html</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_before_thead</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thead</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_after_tbody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_html</span><span class="p">()</span>

<div class="viewcode-block" id="HTMLSplitData.split_html">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.HTMLSplitData.split_html">[docs]</a>
    <span class="k">def</span> <span class="nf">split_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Split HTML text into parts before &lt;thead&gt;, &lt;thead&gt;, before &lt;tbody&gt;, &lt;tbody&gt;, and after &lt;tbody&gt;</span>
        <span class="n">parts_before_thead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;thead&gt;&#39;</span><span class="p">)</span>
        <span class="n">text_before_thead</span> <span class="o">=</span> <span class="n">parts_before_thead</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">thead_parts</span> <span class="o">=</span> <span class="n">parts_before_thead</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;/thead&gt;&#39;</span><span class="p">)</span>
        <span class="n">thead</span> <span class="o">=</span> <span class="s1">&#39;&lt;thead&gt;&#39;</span> <span class="o">+</span> <span class="n">thead_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;/thead&gt;&#39;</span>
        <span class="n">text_before_tbody</span> <span class="o">=</span> <span class="n">thead_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">tbody_parts</span> <span class="o">=</span> <span class="n">text_before_tbody</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">)</span>
        <span class="n">tbody</span> <span class="o">=</span> <span class="s1">&#39;&lt;tbody&gt;&#39;</span> <span class="o">+</span> <span class="n">tbody_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&lt;/tbody&gt;&#39;</span>
        <span class="n">text_after_tbody</span> <span class="o">=</span> <span class="n">tbody_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;/tbody&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">text_before_thead</span><span class="p">,</span> <span class="n">thead</span><span class="p">,</span> <span class="n">tbody</span><span class="p">,</span> <span class="n">text_after_tbody</span></div>
</div>


<div class="viewcode-block" id="center_title_under_years">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.center_title_under_years">[docs]</a>
<span class="k">def</span> <span class="nf">center_title_under_years</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title_row_index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">year_row_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Center a title (specified by its index in the list) under the years row in a list of strings.</span>
<span class="sd">    </span>
<span class="sd">    :param data: List of strings representing the data.</span>
<span class="sd">    :param title_row_index: Index of the title row in the list. Defaults to 1.</span>
<span class="sd">    :return: A new list of strings with the centered title.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make a shallow copy of the list to avoid modifying the original list</span>
    <span class="n">adjusted_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Find the start and end indices of the year values in the first row</span>
    <span class="n">year_row</span> <span class="o">=</span> <span class="n">adjusted_data</span><span class="p">[</span><span class="n">year_row_index</span><span class="p">]</span>
    <span class="n">start_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_row</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_row</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
    <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_row</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    
    <span class="c1"># Calculate the total space available for centering</span>
    <span class="n">total_space</span> <span class="o">=</span> <span class="n">end_index</span> <span class="o">-</span> <span class="n">start_index</span>
    
    <span class="c1"># Center the title within this space</span>
    <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="n">title_row_index</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">adjusted_data</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span><span class="s1">&#39;   &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove leading and trailing spaces</span>
        <span class="n">centered_title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">total_space</span><span class="p">)</span>
        
        <span class="c1"># Replace the original title in the list with the centered title</span>
        <span class="c1"># Ensuring that the centered title is positioned correctly relative to the entire line</span>
        <span class="n">adjusted_data</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year_row</span><span class="p">[:</span><span class="n">start_index</span><span class="p">]</span><span class="si">}{</span><span class="n">centered_title</span><span class="si">}{</span><span class="n">year_row</span><span class="p">[</span><span class="n">end_index</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>
        
    <span class="k">return</span> <span class="n">adjusted_data</span></div>



<div class="viewcode-block" id="create_instance_from_json">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.create_instance_from_json">[docs]</a>
<span class="k">def</span> <span class="nf">create_instance_from_json</span><span class="p">(</span><span class="n">mmodel</span><span class="p">,</span><span class="n">json_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">find_classes_matching_pattern</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds and returns a dictionary of classes in the current module that match</span>
<span class="sd">        the pattern &#39;Display*Def&#39;, where the keys are the class names and the values</span>
<span class="sd">        are the actual class objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Display.*Def$&#39;</span><span class="p">)</span>
        <span class="n">class_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="bp">cls</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
                      <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">type</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">class_dict</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
    <span class="n">display_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;display_type&#39;</span><span class="p">]</span>
    
    
    <span class="n">class_map</span> <span class="o">=</span> <span class="n">find_classes_matching_pattern</span><span class="p">()</span> 
    <span class="c1"># print(class_map)</span>
    
    <span class="k">if</span> <span class="n">display_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_map</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported display type: </span><span class="si">{</span><span class="n">display_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">display_type</span> <span class="o">==</span> <span class="s1">&#39;DisplayContainerDef&#39;</span> <span class="p">:</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">DisplayContainerDef</span><span class="o">.</span><span class="n">reports_restore</span><span class="p">(</span><span class="n">mmodel</span><span class="p">,</span><span class="n">json_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="c1"># Get the class</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">class_map</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span>
        
        <span class="c1"># Process options and lines</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line</span><span class="p">(</span><span class="o">**</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]]</span>
        
        <span class="c1"># Create DisplaySpec instance</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
        
        <span class="c1"># Create the display type instance (e.g., DisplayVarTableDef)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">mmodel</span><span class="p">,</span><span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">instance</span></div>


<div class="viewcode-block" id="create_column_multiindex">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.create_column_multiindex">[docs]</a>
<span class="k">def</span> <span class="nf">create_column_multiindex</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms the columns of a DataFrame into a MultiIndex, where the first column&#39;s name</span>
<span class="sd">    becomes the top level, and the names of the remaining columns serve as the second level.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (pd.DataFrame): The DataFrame to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame: A DataFrame with MultiIndex columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retrieve the name of the first column to be used as the top level of the MultiIndex</span>
    <span class="n">top_level_name</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create a MultiIndex from the first column name and the names of the remaining columns</span>
    <span class="n">multiindex_columns</span> <span class="o">=</span> <span class="p">[(</span><span class="n">top_level_name</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

    <span class="c1"># Construct a new DataFrame with the MultiIndex columns</span>
    <span class="n">multiindex_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">multiindex_columns</span><span class="p">))</span>
    <span class="c1"># print(multiindex_df)</span>
    <span class="k">return</span> <span class="n">multiindex_df</span></div>



<div class="viewcode-block" id="center_multiindex_headers">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.center_multiindex_headers">[docs]</a>
<span class="k">def</span> <span class="nf">center_multiindex_headers</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;th.level0&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">)]},</span>
        <span class="c1"># {&#39;selector&#39;: &#39;th&#39;, &#39;props&#39;: [(&#39;font-size&#39;, &#39;12pt&#39;)]},</span>
       <span class="p">{</span>
           <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;.row_heading, .corner&#39;</span><span class="p">,</span>
           <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
               <span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;sticky&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;300px&#39;</span><span class="p">),</span>  <span class="c1"># Set the width of the row headings</span>
               <span class="p">(</span><span class="s1">&#39;min-width&#39;</span><span class="p">,</span> <span class="s1">&#39;200px&#39;</span><span class="p">),</span>  <span class="c1"># Ensure the minimum width is respected</span>
               <span class="p">(</span><span class="s1">&#39;max-width&#39;</span><span class="p">,</span> <span class="s1">&#39;400px&#39;</span><span class="p">)</span>  <span class="c1"># Ensure the maximum width is respected</span>
           <span class="p">]</span>
       <span class="p">},</span>
       <span class="p">{</span>
           <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;.col_heading&#39;</span><span class="p">,</span>
           <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
               <span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;sticky&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">),</span>
               <span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
           <span class="p">]</span>
       <span class="p">},</span>
       <span class="p">{</span>
           <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span>
           <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
               <span class="p">(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="c1"># Align text to the left</span>
               <span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">),</span>  <span class="c1"># Ensuring headers are not transparent</span>
                  <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>  <span class="c1"># Headers z-index on par with column headings</span>
           <span class="p">]</span>
       <span class="p">},</span>
           <span class="p">{</span>
               <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;td&#39;</span><span class="p">,</span>  <span class="c1"># Targeting data cells</span>
               <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
                   <span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">),</span>  <span class="c1"># Lower z-index than headers</span>
               <span class="p">]</span>
           <span class="p">},</span>
       
       
       <span class="p">{</span>
           <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;caption&#39;</span><span class="p">,</span>
           <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[</span>
               <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;16px&#39;</span><span class="p">),</span>  <span class="c1"># Make the font larger</span>
               <span class="p">(</span><span class="s1">&#39;font-weight&#39;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>  <span class="c1"># Make the font bold</span>
           <span class="p">]</span>
       <span class="p">}</span>  
        
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">style</span></div>



<div class="viewcode-block" id="create_column_multiindex__">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.create_column_multiindex__">[docs]</a>
<span class="k">def</span> <span class="nf">create_column_multiindex__</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms the columns of a DataFrame into a MultiIndex, where the first column&#39;s name</span>
<span class="sd">    becomes the top level, and the names of the remaining columns serve as the second level.</span>
<span class="sd">    The top level name will only be shown once in the MultiIndex representation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df (pd.DataFrame): The DataFrame to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame: A DataFrame with MultiIndex columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retrieve the name of the first column to be used as the top level of the MultiIndex</span>
    <span class="n">top_level_name</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create a list of tuples for the MultiIndex where the first element is the top level name</span>
    <span class="c1"># and only use it once as the top level label for all subsequent columns</span>
    <span class="n">multiindex_columns</span> <span class="o">=</span> <span class="p">[(</span><span class="n">top_level_name</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="n">top_level_name</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="c1"># Construct a new DataFrame with the MultiIndex columns</span>
    <span class="n">multiindex_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">multiindex_columns</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">multiindex_df</span></div>


<div class="viewcode-block" id="format_list_with_numbers">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.format_list_with_numbers">[docs]</a>
<span class="k">def</span> <span class="nf">format_list_with_numbers</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format a list of items with numbered prefixes.</span>

<span class="sd">    Args:</span>
<span class="sd">    items (list of str): The list of items to be formatted, where each item is a string separated by &#39;|&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    list of str: The formatted list with numbered prefixes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This dictionary will keep track of the counts of each prefix</span>
    <span class="n">count_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># This will be the resulting list with formatted strings</span>
    <span class="n">formatted_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># First pass: count occurrences of each prefix</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">count_dict</span><span class="p">:</span>
            <span class="n">count_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">count_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Second pass: format based on the count</span>
    <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># This dictionary keeps track of the running count used for numbering</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># Determine the numbering based on the count</span>
        <span class="k">if</span> <span class="n">count_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="p">:</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">formatted_item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">temp_dict</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formatted_item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">formatted_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_item</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">formatted_list</span></div>


<div class="viewcode-block" id="add_footer_to_styler">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.add_footer_to_styler">[docs]</a>
<span class="k">def</span> <span class="nf">add_footer_to_styler</span><span class="p">(</span><span class="n">styler</span><span class="p">,</span> <span class="n">footer_text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extend a Pandas Styler object with a footer.</span>

<span class="sd">    Args:</span>
<span class="sd">        styler (pandas.io.formats.style.Styler): The Pandas Styler object.</span>
<span class="sd">        footer_text (str): The text to be included in the footer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The styled HTML with the added footer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert styler to HTML and append a footer section</span>
    <span class="n">styled_html</span> <span class="o">=</span> <span class="n">styler</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">na_rep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># or styler.to_html() in older pandas versions</span>
    <span class="n">footer_html</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;tfoot&gt;&lt;tr&gt;&lt;td colspan=&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">styler</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; style=&#39;text-align: left;&#39;&gt;</span><span class="si">{</span><span class="n">footer_text</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;&quot;</span>
    
    <span class="c1"># Insert the footer just before the closing table tag</span>
    <span class="n">styled_html_with_footer</span> <span class="o">=</span> <span class="n">styled_html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/table&gt;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">footer_html</span><span class="si">}</span><span class="s1">&lt;/table&gt;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">styled_html_with_footer</span></div>


<div class="viewcode-block" id="split_text_html_latex">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.split_text_html_latex">[docs]</a>
<span class="k">def</span> <span class="nf">split_text_html_latex</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">):</span>
                <span class="n">html</span><span class="p">,</span><span class="n">latex</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">)</span>
            <span class="c1"># If the left-hand side operand is a string, this method will be called</span>
                <span class="n">linstance</span> <span class="o">=</span>  <span class="n">DisplayTextDef</span><span class="p">(</span><span class="n">spec</span> <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">html_text</span><span class="o">=</span><span class="n">other</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;html Text&#39;</span><span class="p">)))</span>
                
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linstance</span> <span class="o">=</span>  <span class="n">DisplayTextDef</span><span class="p">(</span><span class="n">spec</span> <span class="o">=</span> <span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">html_text</span><span class="o">=</span><span class="n">other</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;latex Text&#39;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="split_text">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.split_text">[docs]</a>
<span class="k">def</span> <span class="nf">split_text</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split the input string based on the specified terminals.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_string (str): The input string to be split.</span>

<span class="sd">    Returns:</span>
<span class="sd">    tuple: A tuple containing three substrings:</span>
<span class="sd">        - The first substring before any terminals.</span>
<span class="sd">        - The substring between &lt;latex&gt; and &lt;/latex&gt; terminals.</span>
<span class="sd">        - The substring between &lt;html&gt; and &lt;/html&gt; terminals.</span>
<span class="sd">        - The substring between &lt;markdown&gt; and &lt;/markdown&gt; terminals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the indices of terminals</span>
    <span class="n">latex_start</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;latex&gt;&quot;</span><span class="p">)</span>
    <span class="n">html_start</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">)</span>
    <span class="n">markdown_start</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;markdown&gt;&quot;</span><span class="p">)</span>
    <span class="n">latex_end</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/latex&gt;&quot;</span><span class="p">)</span>
    <span class="n">html_end</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/html&gt;&quot;</span><span class="p">)</span>
    <span class="n">markdown_end</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/markdown&gt;&quot;</span><span class="p">)</span>
    
    <span class="c1"># If terminals are not found, set their indices to the end of the string</span>
    <span class="k">if</span> <span class="n">latex_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">latex_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">html_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">html_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">markdown_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">markdown_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">latex_end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">latex_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">html_end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">html_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">markdown_end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">markdown_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    
    <span class="c1"># Extract the content between terminals</span>
    <span class="n">latex_content</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">latex_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;latex&gt;&quot;</span><span class="p">):</span><span class="n">latex_end</span><span class="p">]</span>
    <span class="n">html_content</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">html_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">):</span><span class="n">html_end</span><span class="p">]</span>
    <span class="n">markdown_content</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">markdown_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;markdown&gt;&quot;</span><span class="p">):</span><span class="n">markdown_end</span><span class="p">]</span>
    
    <span class="c1"># If no terminals are present, separate the first part as text</span>
    <span class="n">text_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">html_start</span><span class="p">,</span> <span class="n">markdown_start</span><span class="p">,</span> <span class="n">latex_start</span><span class="p">)</span>
    <span class="n">first_part</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[:</span><span class="n">text_end</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">first_part</span><span class="p">,</span> <span class="n">latex_content</span><span class="p">,</span> <span class="n">html_content</span><span class="p">,</span> <span class="n">markdown_content</span></div>


<div class="viewcode-block" id="get_DisplayTextDef">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.get_DisplayTextDef">[docs]</a>
<span class="k">def</span> <span class="nf">get_DisplayTextDef</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a DisplayTextDef object based on the input string.</span>

<span class="sd">    Args:</span>
<span class="sd">    input_string (str): The input string to be processed.</span>

<span class="sd">    Returns:</span>
<span class="sd">    DisplayTextDef: A DisplayTextDef object with the text, HTML, LaTeX, and Markdown content.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the indices of terminals and extract substrings</span>
    <span class="n">text_obj</span> <span class="o">=</span> <span class="n">SplitTextResult</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
    
    <span class="c1"># Create a DisplayTextDef object with the extracted content</span>
    
    <span class="n">out</span> <span class="o">=</span> <span class="n">DisplayTextDef</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">DisplaySpec</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">Options</span><span class="p">(</span>
        <span class="n">text_text</span><span class="o">=</span><span class="n">text_obj</span><span class="o">.</span><span class="n">text_text</span><span class="p">,</span>
        <span class="n">html_text</span><span class="o">=</span><span class="n">text_obj</span><span class="o">.</span> <span class="n">html_text</span><span class="p">,</span>
        <span class="n">latex_text</span><span class="o">=</span><span class="n">text_obj</span><span class="o">.</span><span class="n">latex_text</span><span class="p">,</span> 
        <span class="n">markdown_text</span><span class="o">=</span><span class="n">text_obj</span><span class="o">.</span><span class="n">markdown_text</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;some_text&#39;</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="insert_centered_row">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.insert_centered_row">[docs]</a>
<span class="k">def</span> <span class="nf">insert_centered_row</span><span class="p">(</span><span class="n">html_text</span><span class="p">,</span> <span class="n">centered_text</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">):</span>
    <span class="c1"># Find the index where the tbody starts</span>
    <span class="n">tbody_start_index</span> <span class="o">=</span> <span class="n">html_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;&lt;tbody&gt;&#39;</span><span class="p">)</span>   
    
    <span class="c1"># Construct the new row with centered text</span>
    <span class="n">col0</span> <span class="o">=</span> <span class="s1">&#39;&lt;tr&gt;&lt;td &lt;th class=&quot;row_heading level0 row0&quot; &gt;  &lt;/td&gt;&#39;</span>

    <span class="n">new_row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">col0</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&lt;td colspan=&#39;</span><span class="si">{</span><span class="n">num_columns</span><span class="si">}</span><span class="s2">&#39; style=&#39;text-align: center;position: sticky; top: 0; background: white; left: 0;&#39;&gt;</span><span class="si">{</span><span class="n">centered_text</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span>
    
    <span class="c1"># Insert the new row at the beginning of the tbody</span>
    
    <span class="n">modified_html_text</span> <span class="o">=</span> <span class="n">html_text</span><span class="p">[:</span><span class="n">tbody_start_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_row</span> <span class="o">+</span> <span class="n">html_text</span><span class="p">[</span><span class="n">tbody_start_index</span><span class="p">:]</span>
    
    <span class="k">return</span> <span class="n">modified_html_text</span></div>



<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<div class="viewcode-block" id="SplitTextResult">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.SplitTextResult">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SplitTextResult</span><span class="p">:</span>
    <span class="n">input_string</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">text_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">latex_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">html_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">markdown_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_string</span><span class="p">)</span>
        
<div class="viewcode-block" id="SplitTextResult.split_text">
<a class="viewcode-back" href="../report/modelreport.html#modelreport.SplitTextResult.split_text">[docs]</a>
    <span class="k">def</span> <span class="nf">split_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split the input string based on the specified terminals.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">        input_string (str): The input string to be split.</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the indices of terminals</span>
        <span class="n">latex_start</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;latex&gt;&quot;</span><span class="p">)</span>
        <span class="n">html_start</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">)</span>
        <span class="n">markdown_start</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;markdown&gt;&quot;</span><span class="p">)</span>
        <span class="n">latex_end</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/latex&gt;&quot;</span><span class="p">)</span>
        <span class="n">html_end</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/html&gt;&quot;</span><span class="p">)</span>
        <span class="n">markdown_end</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;/markdown&gt;&quot;</span><span class="p">)</span>
        
        <span class="c1"># If terminals are not found, set their indices to the end of the string</span>
        <span class="k">if</span> <span class="n">latex_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">latex_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">html_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">html_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markdown_start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">markdown_start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">latex_end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">latex_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">html_end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">html_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markdown_end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">markdown_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_string</span><span class="p">)</span>

        <span class="c1"># If no terminals are present, separate the first part as text</span>
        <span class="n">text_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">html_start</span><span class="p">,</span> <span class="n">markdown_start</span><span class="p">,</span> <span class="n">latex_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_text</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[:</span><span class="n">text_end</span><span class="p">]</span>

        <span class="c1"># Extract the content between terminals</span>
        <span class="n">latex_content_</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">latex_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;latex&gt;&quot;</span><span class="p">):</span><span class="n">latex_end</span><span class="p">]</span>
        <span class="n">html_content_</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">html_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">):</span><span class="n">html_end</span><span class="p">]</span>
        <span class="n">markdown_content_</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">markdown_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&lt;markdown&gt;&quot;</span><span class="p">):</span><span class="n">markdown_end</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latex_text</span> <span class="o">=</span> <span class="n">latex_content_</span> <span class="k">if</span> <span class="n">latex_content_</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_text</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">html_text</span> <span class="o">=</span> <span class="n">html_content_</span> <span class="k">if</span> <span class="n">html_content_</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_text</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">markdown_text</span> <span class="o">=</span> <span class="n">markdown_content_</span> <span class="k">if</span> <span class="n">markdown_content_</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_text</span> </div>
</div>


<span class="c1"># Test the implementation</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">SplitTextResult</span><span class="p">(</span><span class="s2">&quot;&lt;html&gt;Hello&lt;/html&gt;&lt;latex&gt;Latex Content&lt;/latex&gt;&lt;markdown&gt;Markdown Content&lt;/markdown&gt;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    
    
    
    <span class="nb">print</span><span class="p">(</span><span class="n">SplitTextResult</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">SplitTextResult</span><span class="p">(</span><span class="s1">&#39;test&lt;latex&gt;notest&lt;/latex&lt;html&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">get_DisplayTextDef</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">))</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ib Hansen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>